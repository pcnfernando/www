<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v4.x/docs/query-guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.0">
    
    
      
        <title>Query Guide - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#siddhi-4x-streaming-sql-guide" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v4.x/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Query Guide
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v4.x</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v4.x/en/docs/docs/query-guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v4.x/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Query Guide
      </label>
    
    <a href="./" title="Query Guide" class="md-nav__link md-nav__link--active">
      Query Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-application" title="Siddhi Application" class="md-nav__link">
    Siddhi Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" title="Stream" class="md-nav__link">
    Stream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source-mapper" title="Source Mapper" class="md-nav__link">
    Source Mapper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink" title="Sink" class="md-nav__link">
    Sink
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distributed-sink" title="Distributed Sink" class="md-nav__link">
    Distributed Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink-mapper" title="Sink Mapper" class="md-nav__link">
    Sink Mapper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-projection" title="Query Projection" class="md-nav__link">
    Query Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function" title="Function" class="md-nav__link">
    Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" title="Filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" title="Window" class="md-nav__link">
    Window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-function" title="Aggregate function" class="md-nav__link">
    Aggregate function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by" title="Order By" class="md-nav__link">
    Order By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-offset" title="Limit &amp; Offset" class="md-nav__link">
    Limit &amp; Offset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-stream" title="Join (Stream)" class="md-nav__link">
    Join (Stream)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern" title="Pattern" class="md-nav__link">
    Pattern
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-pattern" title="Counting Pattern" class="md-nav__link">
    Counting Pattern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-patterns" title="Logical Patterns" class="md-nav__link">
    Logical Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detecting-non-occurring-events" title="Detecting Non-occurring Events" class="md-nav__link">
    Detecting Non-occurring Events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partition" title="Partition" class="md-nav__link">
    Partition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-stream" title="Inner Stream" class="md-nav__link">
    Inner Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table" title="Table" class="md-nav__link">
    Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#store" title="Store" class="md-nav__link">
    Store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-table" title="Join (Table)" class="md-nav__link">
    Join (Table)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-aggregation" title="Incremental Aggregation" class="md-nav__link">
    Incremental Aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distributed-aggregation" title="Distributed Aggregation" class="md-nav__link">
    Distributed Aggregation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-aggregation" title="Join (Aggregation)" class="md-nav__link">
    Join (Aggregation)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defined-window" title="(Defined) Window" class="md-nav__link">
    (Defined) Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert_1" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-window" title="Join (Window)" class="md-nav__link">
    Join (Window)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" title="From" class="md-nav__link">
    From
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trigger" title="Trigger" class="md-nav__link">
    Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-query" title="Store Query" class="md-nav__link">
    Store Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tablewindow-select" title="(Table/Window) Select" class="md-nav__link">
    (Table/Window) Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-select" title="(Aggregation) Select" class="md-nav__link">
    (Aggregation) Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert_2" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_1" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_1" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert_1" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-custom-extensions" title="Writing Custom Extensions" class="md-nav__link">
    Writing Custom Extensions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-and-monitoring-siddhi-applications" title="Configuring and Monitoring Siddhi Applications" class="md-nav__link">
    Configuring and Monitoring Siddhi Applications
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threading-and-asynchronous" title="Threading and Asynchronous" class="md-nav__link">
    Threading and Asynchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-streams" title="Fault Streams" class="md-nav__link">
    Fault Streams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statistics" title="Statistics" class="md-nav__link">
    Statistics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-playback" title="Event Playback" class="md-nav__link">
    Event Playback
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Siddhi Core APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Siddhi Core APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.5.11/" title="4.5.11" class="md-nav__link">
      4.5.11
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.5.10/" title="4.5.10" class="md-nav__link">
      4.5.10
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.5.9/" title="4.5.9" class="md-nav__link">
      4.5.9
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.5.0/" title="4.5.0" class="md-nav__link">
      4.5.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.4.8/" title="4.4.8" class="md-nav__link">
      4.4.8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.4.3/" title="4.4.8" class="md-nav__link">
      4.4.8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.4.0/" title="4.4.0" class="md-nav__link">
      4.4.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.3.19/" title="4.3.19" class="md-nav__link">
      4.3.19
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.3.0/" title="4.3.0" class="md-nav__link">
      4.3.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.2.40/" title="4.2.40" class="md-nav__link">
      4.2.40
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.2.20/" title="4.2.20" class="md-nav__link">
      4.2.20
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.2.0/" title="4.2.0" class="md-nav__link">
      4.2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.1.64/" title="4.1.64" class="md-nav__link">
      4.1.64
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.1.46/" title="4.1.46" class="md-nav__link">
      4.1.46
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.1.7/" title="4.1.7" class="md-nav__link">
      4.1.7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.1.0/" title="4.1.0" class="md-nav__link">
      4.1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.0.9/" title="4.0.9" class="md-nav__link">
      4.0.9
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/4.0.0/" title="4.0.0" class="md-nav__link">
      4.0.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../siddhi-in-wso2-stream-processor/" title="Siddhi in WSO2 Stream Processor" class="md-nav__link">
      Siddhi in WSO2 Stream Processor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../siddhi-as-a-java-library/" title="Siddhi Java library" class="md-nav__link">
      Siddhi Java library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../siddhi-as-a-python-library/" title="Siddhi Python library" class="md-nav__link">
      Siddhi Python library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-application" title="Siddhi Application" class="md-nav__link">
    Siddhi Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" title="Stream" class="md-nav__link">
    Stream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source-mapper" title="Source Mapper" class="md-nav__link">
    Source Mapper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink" title="Sink" class="md-nav__link">
    Sink
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distributed-sink" title="Distributed Sink" class="md-nav__link">
    Distributed Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink-mapper" title="Sink Mapper" class="md-nav__link">
    Sink Mapper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-projection" title="Query Projection" class="md-nav__link">
    Query Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function" title="Function" class="md-nav__link">
    Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" title="Filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" title="Window" class="md-nav__link">
    Window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-function" title="Aggregate function" class="md-nav__link">
    Aggregate function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by" title="Order By" class="md-nav__link">
    Order By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-offset" title="Limit &amp; Offset" class="md-nav__link">
    Limit &amp; Offset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-stream" title="Join (Stream)" class="md-nav__link">
    Join (Stream)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern" title="Pattern" class="md-nav__link">
    Pattern
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-pattern" title="Counting Pattern" class="md-nav__link">
    Counting Pattern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-patterns" title="Logical Patterns" class="md-nav__link">
    Logical Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detecting-non-occurring-events" title="Detecting Non-occurring Events" class="md-nav__link">
    Detecting Non-occurring Events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partition" title="Partition" class="md-nav__link">
    Partition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-stream" title="Inner Stream" class="md-nav__link">
    Inner Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table" title="Table" class="md-nav__link">
    Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#store" title="Store" class="md-nav__link">
    Store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-table" title="Join (Table)" class="md-nav__link">
    Join (Table)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-aggregation" title="Incremental Aggregation" class="md-nav__link">
    Incremental Aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distributed-aggregation" title="Distributed Aggregation" class="md-nav__link">
    Distributed Aggregation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-aggregation" title="Join (Aggregation)" class="md-nav__link">
    Join (Aggregation)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defined-window" title="(Defined) Window" class="md-nav__link">
    (Defined) Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert_1" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-window" title="Join (Window)" class="md-nav__link">
    Join (Window)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" title="From" class="md-nav__link">
    From
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trigger" title="Trigger" class="md-nav__link">
    Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#store-query" title="Store Query" class="md-nav__link">
    Store Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tablewindow-select" title="(Table/Window) Select" class="md-nav__link">
    (Table/Window) Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-select" title="(Aggregation) Select" class="md-nav__link">
    (Aggregation) Select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert_2" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_1" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_1" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert_1" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-custom-extensions" title="Writing Custom Extensions" class="md-nav__link">
    Writing Custom Extensions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-and-monitoring-siddhi-applications" title="Configuring and Monitoring Siddhi Applications" class="md-nav__link">
    Configuring and Monitoring Siddhi Applications
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threading-and-asynchronous" title="Threading and Asynchronous" class="md-nav__link">
    Threading and Asynchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-streams" title="Fault Streams" class="md-nav__link">
    Fault Streams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statistics" title="Statistics" class="md-nav__link">
    Statistics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-playback" title="Event Playback" class="md-nav__link">
    Event Playback
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v4.x/en/docs/docs/query-guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="siddhi-4x-streaming-sql-guide">Siddhi 4.x Streaming SQL Guide<a class="headerlink" href="#siddhi-4x-streaming-sql-guide" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Siddhi Streaming SQL is designed to process event streams in a streaming manner, detect complex event occurrences, 
and notify them in real-time. </p>
<h2 id="siddhi-application">Siddhi Application<a class="headerlink" href="#siddhi-application" title="Permanent link">&para;</a></h2>
<p>Streaming processing and Complex Event Processing rules can be written is Siddhi Streaming SQL and they can be put 
together as a <code>SiddhiApp</code> in a single file. </p>
<p><strong>Purpose</strong></p>
<p>Each Siddhi Application is an isolated processing unit that allows you to deploy and execute queries independent of other Siddhi applications in the system.</p>
<p>The following diagram depicts how <strong>event flows</strong> work with some of the key Siddhi Streaming SQL elements 
The following diagram depicts how <strong>event flows</strong> work with some of the key Siddhi Streaming SQL elements 
of the Siddhi Application.</p>
<p><img alt="Event Flow" src="../../images/event-flow.png?raw=true" title="Event Flow" /></p>
<p>Below table provides brief description of a few key elements in the Siddhi Streaming SQL Language.</p>
<table>
<thead>
<tr>
<th>Elements</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stream</td>
<td>A logical series of events ordered in time with a uniquely identifiable name, and set of defined attributes with specific data types defining its schema.</td>
</tr>
<tr>
<td>Event</td>
<td>An event is associated with only one stream, and all events of that stream have an identical set of attributes that are assigned specific types (or the same schema). An event contains a timestamp and set of attribute values according to the schema.</td>
</tr>
<tr>
<td>Table</td>
<td>A structured representation of data stored with a defined schema. Stored data can be backed by <code>In-Memory</code>, <code>RDBMs</code>, <code>MongoDB</code>, etc. to be accessed and manipulated at runtime.</td>
</tr>
<tr>
<td>Query</td>
<td>A logical construct that processes events in streaming manner by combining existing streams and/or tables, and generates events to an output stream or table. A query consumes one or more input streams, and zero or one table. Then it processes these events in a streaming manner and publishes the output events to streams or tables for further processing or to generate notifications.</td>
</tr>
<tr>
<td>Source</td>
<td>A contract that consumes data from external sources (such as <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc)in the form of events, then converts each event (which can be in <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc. format) to a Siddhi event, and passes that to a Stream for processing.</td>
</tr>
<tr>
<td>Sink</td>
<td>A contract that takes events arriving at a stream, maps them to a predefined data format (such as <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc), and publishes them to external endpoints (such as <code>E-mail</code>, <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc).</td>
</tr>
<tr>
<td>Input Handler</td>
<td>A mechanism to programmatically inject events into streams.</td>
</tr>
<tr>
<td>Stream/Query Callback</td>
<td>A mechanism to programmatically consume output events from streams and queries.</td>
</tr>
<tr>
<td>Partition</td>
<td>A logical container that isolates the processing of queries based on partition keys. Here, a separate instance of queries is generated for each partition key to achieve isolation.</td>
</tr>
<tr>
<td>Inner Stream</td>
<td>A positionable stream that connects portioned queries within their partitions, preserving isolation.</td>
</tr>
</tbody>
</table>
<p><strong>Grammar</strong></p>
<p>An element of Siddhi SQL can be composed together as a script in a Siddhi application, Here each construct must be separated 
by a semicolon <code>( ; )</code> as shown in the below syntax. </p>
<pre class="codehilite"><code class="linenums">&lt;siddhi app&gt;  : 
        &lt;app annotation&gt; * 
        ( &lt;stream definition&gt; | &lt;table definition&gt; | ... ) + 
        ( &lt;query&gt; | &lt;partition&gt; ) +
        ;</code></pre>

<p><strong>Example</strong>
Siddhi Application named <code>Temperature-Analytics</code> defined with a stream named <code>TempStream</code> and a query 
named <code>5minAvgQuery</code> for processing it.</p>
<pre class="codehilite"><code class="language-sql linenums">@app:name('Temperature-Analytics')

define stream TempStream (deviceID long, roomNo int, temp double);

@info(name = '5minAvgQuery')
from TempStream#window.time(5 min)
select roomNo, avg(temp) as avgTemp
  group by roomNo
insert into OutputStream;</code></pre>

<h2 id="stream">Stream<a class="headerlink" href="#stream" title="Permanent link">&para;</a></h2>
<p>A stream is a logical series of events ordered in time. Its schema is defined via the <strong>stream definition</strong>.
A stream definition contains a unique name and a set of attributes with specific types and uniquely identifiable names within the stream.
All the events that are selected to be received into a specific stream have the same schema (i.e., have the same attributes in the same order). </p>
<p><strong>Purpose</strong></p>
<p>By defining a schema it unifies common types of events together. This enables them to be processed via queries using their defined attributes in a streaming manner, and allow sinks and sources to map events to/from various data formats.</p>
<p><strong>Syntax</strong></p>
<p>The syntax for defining a new stream is as follows.
<pre class="codehilite"><code class="language-sql linenums">define stream &lt;stream name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... );</code></pre>
The following parameters are configured in a stream definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stream name</code></td>
<td>The name of the stream created. (It is recommended to define a stream name in <code>PascalCase</code>.)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of an stream is defined by its attributes with uniquely identifiable attribute names. (It is recommended to define attribute names in <code>camelCase</code>.)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
</tbody>
</table>
<p>To use and refer stream and attribute names that do not follow <code>[a-zA-Z_][a-zA-Z_0-9]*</code> format enclose them in <code>`. E.g. ```</code>$test(0)` ```.</p>
<p>To make the stream process events in asynchronous and multi-threading manner use the <code>@Async</code> annotation as shown in 
<a href="#threading-and-asynchronous">Threading and Asynchronous</a> configuration section.</p>
<p><strong>Example</strong>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream (deviceID long, roomNo int, temp double);</code></pre>
The above creates a stream named <code>TempStream</code> with the following attributes.</p>
<ul>
<li><code>deviceID</code> of type <code>long</code></li>
<li><code>roomNo</code> of type <code>int</code> </li>
<li><code>temp</code> of type <code>double</code> </li>
</ul>
<h3 id="source">Source<a class="headerlink" href="#source" title="Permanent link">&para;</a></h3>
<p>Sources receive events via multiple transports and in various data formats, and direct them into streams for processing.</p>
<p>A source configuration allows you to define a mapping in order to convert each incoming event from its native data format to a Siddhi event. When customizations to such mappings are not provided, Siddhi assumes that the arriving event adheres to the predefined format based on the stream definition and the selected message format. </br></p>
<p><strong>Purpose</strong></p>
<p>Source allows Siddhi to consume events from external systems, and map the events to adhere to the associated stream. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream that consumes events via a source, add the source configuration to a stream definition by adding the <code>@source</code> annotation with the required parameter values. 
The source syntax is as follows:
<pre class="codehilite"><code class="language-sql linenums">@source(type='source_type', static.option.key1='static_option_value1', static.option.keyN='static_option_valueN',
    @map(type='map_type', static.option_key1='static_option_value1', static.option.keyN='static_option_valueN',
        @attributes( attributeN='attribute_mapping_N', attribute1='attribute_mapping_1')
    )
)
define stream StreamName (attribute1 Type1, attributeN TypeN);</code></pre>
This syntax includes the following annotations.
<strong>Source</strong></p>
<p>The <code>type</code> parameter of <code>@source</code> defines the source type that receives events. The other parameters to be configured 
depends on the source type selected, some of the the parameters are optional. </br></p>
<p>For detailed information about the parameters see the documentation for the relevant source.</p>
<p>The following is the list of source types that are currently supported:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-http/">HTTP</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-kafka/">Kafka</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-tcp/">TCP</a></li>
<li><a target="_blank" href="../api/latest/#inmemory-source">In-memory</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-wso2event/">WSO2Event</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">Email</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-jms/">JMS</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-file/">File</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-rabbitmq/">RabbitMQ</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-mqtt/">MQTT</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-websocket/">WebSocket</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-twitter/">Twitter</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-sqs/">Amazon SQS</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-cdc/">CDC</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-prometheus/">Prometheus</a></li>
</ul>
<h4 id="source-mapper">Source Mapper<a class="headerlink" href="#source-mapper" title="Permanent link">&para;</a></h4>
<p>Each <code>@source</code> configuration has a mapping denoted by the <code>@map</code> annotation that converts the incoming messages format to Siddhi events.</p>
<p>The <code>type</code> parameter of the <code>@map</code> defines the map type to be used to map the data. The other parameters to be 
configured depends on the mapper selected. Some of these parameters are optional. </br>
For detailed information about the parameters see the documentation for the relevant mapper.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When the <code>@map</code> annotation is not provided, <code>@map(type='passThrough')</code> is used as default. This default mapper type can be used when source consumes Siddhi events and when it does not need any mappings.</p>
</div>
<p><strong>Map Attributes</strong></p>
<p><code>@attributes</code> is an optional annotation used with <code>@map</code> to define custom mapping. When <code>@attributes</code> is not provided, each mapper
assumes that the incoming events  adhere to its own default data format. By adding the <code>@attributes</code> annotation, you 
can configure mappers to extract data from the incoming message selectively, and assign them to attributes. </p>
<p>There are two ways you can configure map attributes. </p>
<ol>
<li>Defining attributes as keys and mapping content as values in the following format: <br/>
<code>@attributes( attributeN='mapping_N', attribute1='mapping_1')</code> </li>
<li>Defining the mapping content of all attributes in the same order as how the attributes are defined in stream definition: <br/>
<code>@attributes( 'mapping_1', 'mapping_N')</code> </li>
</ol>
<p><strong>Supported Mapping Types</strong></p>
<p>The following is a list of currently supported source mapping types:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-wso2event/">WSO2Event</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-xml/">XML</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-text/">TEXT</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-json/">JSON</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-binary/">Binary</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-keyvalue/">Key Value</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-csv/">CSV</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-avro/">Avro</a></li>
</ul>
<p><strong>Example</strong></p>
<p>This query receives events via the <code>HTTP</code> source in the <code>JSON</code> data format, and directs them to the <code>InputStream</code> stream for processing. 
Here the HTTP source is configured to receive events on all network interfaces on the <code>8080</code>port, on the <code>foo</code> context, and 
it is secured via basic authentication.</p>
<pre class="codehilite"><code class="language-sql linenums">@source(type='http', receiver.url='http://0.0.0.0:8080/foo', basic.auth.enabled='true', 
  @map(type='json'))
define stream InputStream (name string, age int, country string);</code></pre>

<h3 id="sink">Sink<a class="headerlink" href="#sink" title="Permanent link">&para;</a></h3>
<p>Sinks publish events from the streams via multiple transports to external endpoints in various data formats.</p>
<p>A sink configuration allows you to define a mapping to convert the Siddhi event to the required output data format (such as <code>JSON</code>, <code>TEXT</code>, <code>XML</code>, etc.).
When customization to such mappings is not provided, Siddhi converts events to its default format based on the stream definition and 
the selected data format to publish the events.</p>
<p><strong>Purpose</strong></p>
<p>Sinks provide a way to publish Siddhi events to external systems in the preferred data format. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to publish events via a sink, add the sink configuration to a stream definition by adding the <code>@sink</code> 
annotation with the required parameter values. The sink syntax is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">@sink(type='sink_type', static_option_key1='static_option_value1', dynamic_option_key1='{{dynamic_option_value1}}',
    @map(type='map_type', static_option_key1='static_option_value1', dynamic_option_key1='{{dynamic_option_value1}}',
        @payload('payload_mapping')
    )
)
define stream StreamName (attribute1 Type1, attributeN TypeN);</code></pre>

<div class="admonition note">
<p class="admonition-title">Dynamic Properties</p>
<p>The sink and sink mapper properties that are categorized as <code>dynamic</code> have the ability to absorb attributes values 
from their associated streams. This can be done by using the attribute names in double curly braces as <code>{{...}}</code> when configuring the property value. </p>
<p>Some valid dynamic properties values are: </p>
<ul>
<li><code>'{{attribute1}}'</code></li>
<li><code>'This is {{attribute1}}'</code> </li>
<li><code>{{attribute1}} &gt; {{attributeN}}</code>  </li>
</ul>
<p>Here the attribute names in the double curly braces will be replaced with event values during execution. </p>
</div>
<p>This syntax includes the following annotations.</p>
<p><strong>Sink</strong></p>
<p>The <code>type</code> parameter of the <code>@sink</code> annotation defines the sink type that publishes the events. The other parameters to be configured 
depends on the sink type selected. Some of these parameters are optional, and some can have dynamic values. </br></p>
<p>For detailed information about the parameters see documentation for the relevant sink.</p>
<p>The following is a list of currently supported sink types.</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-http/">HTTP</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-kafka/">Kafka</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-tcp/">TCP</a></li>
<li><a target="_blank" href="../api/latest/#inmemory-sink">In-memory</a></li>
<li><a target="_blank" href="../api/latest/#log-sink">Log</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-wso2event/">WSO2Event</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">Email</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-jms/">JMS</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-file/">File</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-rabbitmq/">RabbitMQ</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-mqtt/">MQTT</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-websocket/">WebSocket</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-sqs/">Amazon SQS</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-prometheus/">Prometheus</a></li>
</ul>
<h4 id="distributed-sink">Distributed Sink<a class="headerlink" href="#distributed-sink" title="Permanent link">&para;</a></h4>
<p>Distributed Sinks publish events from a defined stream to multiple destination endpoints using load balancing and partitioning strategies.</p>
<p>Any ordinary sink can be used as a distributed sink. A distributed sink configuration allows you to define a common mapping to convert the Siddhi events for all its destination endpoints, 
allows you to define a distribution strategy (e.g. <code>roundRobin</code>, <code>partitioned</code>), and configuration for each specific endpoint destination. </p>
<p><strong>Purpose</strong></p>
<p>Distributed sinks provide a way to publish Siddhi events to multiple destination endpoints in the preferred data format. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to publish events via a distributed sink, add the sink configuration to a stream definition by adding the <code>@sink</code> 
annotation and add the configuration parameters that are common of all the destination endpoints inside the <code>@sink</code> annotation 
along with <code>@distribution</code> and <code>@destination</code> annotations providing distribution strategy and endpoint specific configurations. 
The distributed sink syntax is as follows:</p>
<p><em>RoundRobin Distributed Sink</em></p>
<p>Publishes events to defined destinations in a round robin manner. </p>
<pre class="codehilite"><code class="language-sql linenums">@sink(type='sink_type', common_option_key1='common_option_value1', common_option_key2='{{common_option_value1}}',
    @map(type='map_type', option_key1='option_value1', option_key2='{{option_value1}}',
        @payload('payload_mapping')
    )
    @distribution(strategy='roundRobin',
        @destination(specific_option_key1='specific_option_value1'),
        @destination(specific_option_key1='specific_option_value2')))
)
define stream StreamName (attribute1 Type1, attributeN TypeN);</code></pre>

<p><em>Partitioned Distributed Sink</em></p>
<p>Publishes events to defined destinations by partitioning based on the hashcode of the events partition key. </p>
<pre class="codehilite"><code class="language-sql linenums">@sink(type='sink_type', common_option_key1='common_option_value1', common_option_key2='{{common_option_value1}}',
    @map(type='map_type', option_key1='option_value1', option_key2='{{option_value1}}',
        @payload('payload_mapping')
    )
    @distribution(strategy='partitioned', partitionKey='partition_key',
        @destination(specific_option_key1='specific_option_value1'),
        @destination(specific_option_key1='specific_option_value2')))
)
define stream StreamName (attribute1 Type1, attributeN TypeN);</code></pre>

<h4 id="sink-mapper">Sink Mapper<a class="headerlink" href="#sink-mapper" title="Permanent link">&para;</a></h4>
<p>Each <code>@sink</code> annotation has a mapping denoted by the  <code>@map</code> annotation that converts the Siddhi event to an outgoing message format.</p>
<p>The <code>type</code> parameter of the <code>@map</code> annotation defines the map type based on which the event is mapped. The other parameters to be configured depends on the mapper selected. Some of these parameters are optional and some have dynamic values. </br> </p>
<p>For detailed information about the parameters see the documentation for the relevant mapping type.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When the <code>@map</code> annotation is not provided, <code>@map(type='passThrough')</code> is used by default. This can be used when the sink publishes in the Siddhi event format, or when it does not need any mappings.</p>
</div>
<p><strong>Map Payload</strong></p>
<p><code>@payload</code> is an optional annotation used with the <code>@map</code> annotation to define a custom mapping. When the <code>@payload</code> annotation is not provided, each mapper
maps the outgoing events to its own default data format. By defining the <code>@payload</code> annotation you can configure mappers to produce the output payload with attribute names of your choice, using dynamic properties by selectively assigning 
the attributes in your preferred format. </p>
<p>There are two ways you can configure the <code>@payload</code> annotation. </p>
<ol>
<li>Some mappers such as <code>XML</code>, <code>JSON</code>, and <code>Test</code> accept only one output payload using the following format: <br/>
<code>@payload( 'This is a test message from {{user}}.' )</code> </li>
<li>Some mappers such <code>key-value</code> accept series of mapping values defined as follows: <br/>
<code>@payload( key1='mapping_1', 'key2'='user : {{user}}')</code> <br/>
Here, apart from the dotted key names sush as <code>a.b.c</code>, any constant string value such as <code>'$abc'</code> can also by used as a key. </li>
</ol>
<p><strong>Supported Mapping Types</strong></p>
<p>The following is a list of currently supported sink mapping types:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-wso2event/">WSO2Event</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-xml/">XML</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-text/">TEXT</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-json/">JSON</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-binary/">Binary</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-keyvalue/">Key Value</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-csv/">CSV</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-avro/">Avro</a></li>
</ul>
<p><strong>Example</strong></p>
<p>Following query publishes events from the <code>OutputStream</code> stream to an <code>HTTP</code> endpoint. Here the events are mapped to the default <code>JSON</code> payloads and sent to <code>http://localhost:8005/endpoint</code>
 using the <code>POST</code> method, with the<code>Accept</code> header, and secured via basic authentication where <code>admin</code> is both the username and the password.
<pre class="codehilite"><code class="language-sql linenums">@sink(type='http', publisher.url='http://localhost:8005/endpoint', method='POST', headers='Accept-Date:20/02/2017', 
  basic.auth.username='admin', basic.auth.password='admin', basic.auth.enabled='true',
  @map(type='json'))
define stream OutputStream (name string, ang int, country string);</code></pre></p>
<p>Following query publishes events from the <code>OutputStream</code> stream to multiple the <code>HTTP</code> endpoints using partitioning strategy. Here the events sent to either <code>http://localhost:8005/endpoint1</code>
or <code>http://localhost:8006/endpoint2</code> based on the partitioning key <code>country</code>. It uses default <code>JSON</code> mapping, <code>POST</code> method, and used <code>admin</code> as both the username and the password when publishing to both the endpoints.
<pre class="codehilite"><code class="language-sql linenums">@sink(type='http', method='POST', basic.auth.username='admin', basic.auth.password='admin', 
  basic.auth.enabled='true', @map(type='json'),
  @distribution(strategy='partitioned', partitionKey='country',
     @destination(publisher.url='http://localhost:8005/endpoint1'),
     @destination(publisher.url='http://localhost:8006/endpoint2')))
define stream OutputStream (name string, ang int, country string);</code></pre></p>
<h2 id="query">Query<a class="headerlink" href="#query" title="Permanent link">&para;</a></h2>
<p>Each Siddhi query can consume one or more streams, and 0-1 tables, process the events in a streaming manner, and then generate an
 output event to a stream or perform a CRUD operation to a table.</p>
<p><strong>Purpose</strong></p>
<p>A query enables you to perform complex event processing and stream processing operations by processing incoming events one by one in the order they arrive.</p>
<p><strong>Syntax</strong></p>
<p>All queries contain an input and an output section. Some also contain a projection section. A simple query with all three sections is as follows.</p>
<p><pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream/table&gt;</code></pre>
<strong>Example</strong></p>
<p>This query included in a Siddhi Application consumes events from the <code>TempStream</code> stream (that is already defined) and outputs the room temperature and the room number to the <code>RoomTempStream</code> stream.</p>
<div class="admonition tip">
<p class="admonition-title">Inferred Stream</p>
<p>Here, the <code>RoomTempStream</code> is an inferred Stream, which means it can be used as any other defined stream 
without explicitly defining its stream definition. The definition of the <code>RoomTempStream</code> is inferred from the 
first query that produces the stream.  </p>
</div>
<h3 id="query-projection">Query Projection<a class="headerlink" href="#query-projection" title="Permanent link">&para;</a></h3>
<p>Siddhi queries supports the following for query projections.</p>
<table style="width:100%">
    <tr>
        <th>Action</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>Selecting required objects for projection</td>
        <td>This involves selecting only some of the attributes from the input stream to be inserted into an output stream.
            <br><br>
            E.g., The following query selects only the `roomNo` and `temp` attributes from the `TempStream` stream.
            <pre style="align:left">from TempStream<br>select roomNo, temp<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Selecting all attributes for projection</td>
        <td>Selecting all the attributes in an input stream to be inserted into an output stream. This can be done by using asterisk ( * ) or by omitting the `select` statement.
            <br><br>
            E.g., Both the following queries select all the attributes in the `NewTempStream` stream.
            <pre>from TempStream<br>select *<br>insert into NewTempStream;</pre>
            or
            <pre>from TempStream<br>insert into NewTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Renaming attributes</td>
        <td>This selects attributes from the input streams and inserts them into the output stream with different names.
            <br><br>
            E.g., This query renames `roomNo` to `roomNumber` and `temp` to `temperature`.
            <pre>from TempStream <br>select roomNo as roomNumber, temp as temperature<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Introducing the constant value</td>
        <td>This adds constant values by assigning it to an attribute using `as`.
            <br></br>
            E.g., This query specifies 'C' to be used as the constant value for `scale` attribute. 
            <pre>from TempStream<br>select roomNo, temp, 'C' as scale<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Using mathematical and logical expressions</td>
        <td>This uses attributes with mathematical and logical expressions in the precedence order given below, and assigns them to the output attribute using `as`.
            <br><br>
            <b>Operator precedence</b><br>
            <table style="width:100%">
                <tr>
                    <th>Operator</th>
                    <th>Distribution</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td>
                        ()
                    </td>
                    <td>
                        Scope
                    </td>
                    <td>
                        <pre>(cost + tax) * 0.05</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                         IS NULL
                    </td>
                    <td>
                        Null check
                    </td>
                    <td>
                        <pre>deviceID is null</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        NOT
                    </td>
                    <td>
                        Logical NOT
                    </td>
                    <td>
                        <pre>not (price > 10)</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                         *   /   %  
                    </td>
                    <td>
                        Multiplication, division, modulo
                    </td>
                    <td>
                        <pre>temp * 9/5 + 32</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        +   -  
                    </td>
                    <td>
                        Addition, substraction
                    </td>
                    <td>
                        <pre>temp * 9/5 - 32</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        <   <=   >   >=
                    </td>
                    <td>
                        Comparators: less-than, greater-than-equal, greater-than, less-than-equal
                    </td>
                    <td>
                        <pre>totalCost >= price * quantity</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        ==   !=  
                    </td>
                    <td>
                        Comparisons: equal, not equal
                    </td>
                    <td>
                        <pre>totalCost !=  price * quantity</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        IN
                    </td>
                    <td>
                        Contains in table
                    </td>
                    <td>
                        <pre>roomNo in ServerRoomsTable</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        AND
                    </td>
                    <td>
                        Logical AND
                    </td>
                    <td>
                        <pre>temp < 40 and (humidity < 40 or humidity >= 60)</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        OR
                    </td>
                    <td>
                        Logical OR
                    </td>
                    <td>
                        <pre>temp < 40 or (humidity < 40 and humidity >= 60)</pre>
                    </td>
                </tr>
            </table>
            E.g., Converting Celsius to Fahrenheit and identifying rooms with room number between 10 and 15 as server rooms.
            <pre>from TempStream<br>select roomNo, temp * 9/5 + 32 as temp, 'F' as scale, roomNo > 10 and roomNo < 15 as isServerRoom<br>insert into RoomTempStream;</pre>       
    </tr>

</table>

<h3 id="function">Function<a class="headerlink" href="#function" title="Permanent link">&para;</a></h3>
<p>A function consumes zero, one or more parameters and always produces a result value. It can be used in any location where
 an attribute can be used. </p>
<p><strong>Purpose</strong></p>
<p>Functions encapsulates complex execution logic that makes Siddhi applications simple and easy to understand. </p>
<p><strong>Function Parameters</strong></p>
<p>Functions parameters can be attributes, constant values, results of other functions, results of mathematical or logical expressions or time parameters. 
Function parameters vary depending on the function being called.</p>
<p>Time is a special parameter that can be defined using the integer time value followed by its unit as <code>&lt;int&gt; &lt;unit&gt;</code>. 
Following are the supported unit types. Upon execution, time returns the value in the scale of milliseconds as a long value. </p>
<table style="width:100%">
    <tr>
        <th>
            Unit  
        </th>
        <th>
            Syntax
        </th>
    </tr>
    <tr>
        <td>
            Year
        </td>
        <td>
            year | years
        </td>
    </tr>
    <tr>
        <td>
            Month
        </td>
        <td>
            month | months
        </td>
    </tr>
    <tr>
        <td>
            Week
        </td>
        <td>
            week | weeks
        </td>
    </tr>
    <tr>
        <td>
            Day
        </td>
        <td>
            day | days
        </td>
    </tr>
    <tr>
        <td>
            Hour
        </td>
        <td>
           hour | hours
        </td>
    </tr>
    <tr>
        <td>
           Minutes
        </td>
        <td>
           minute | minutes | min
        </td>
    </tr>
    <tr>
        <td>
           Seconds
        </td>
        <td>
           second | seconds | sec
        </td>
    </tr>
    <tr>
        <td>
           Milliseconds
        </td>
        <td>
           millisecond | milliseconds
        </td>
    </tr>
</table>

<p>E.g. Passing 1 hour and 25 minutes to <code>test()</code> function.</p>
<pre>test(1 hour 25 min)</pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions, mathematical expressions, and logical expressions can be used in a nested manner.</p>
</div>
<p>Following are some inbuilt functions shipped with Siddhi, for more functions refer execution <a target="_blank" href="../extensions/">extensions</a>.</p>
<ul>
<li><a href="../api/latest/#eventtimestamp-function">eventTimestamp</a></li>
<li><a href="../api/latest/#log-stream-processor">log</a></li>
<li><a href="../api/latest/#uuid-function">UUID</a></li>
<li><a href="../api/latest/#default-function">default</a></li>
<li><a href="../api/latest/#cast-function">cast</a></li>
<li><a href="../api/latest/#convert-function">convert</a></li>
<li><a href="../api/latest/#ifthenelse-function">ifThenElse</a></li>
<li><a href="../api/latest/#minimum-function">minimum</a></li>
<li><a href="../api/latest/#maximum-function">maximum</a></li>
<li><a href="../api/latest/#coalesce-function">coalesce</a></li>
<li><a href="../api/latest/#instanceofboolean-function">instanceOfBoolean</a></li>
<li><a href="../api/latest/#instanceofdouble-function">instanceOfDouble</a></li>
<li><a href="../api/latest/#instanceoffloat-function">instanceOfFloat</a></li>
<li><a href="../api/latest/#instanceofinteger-function">instanceOfInteger</a></li>
<li><a href="../api/latest/#instanceoflong-function">instanceOfLong</a></li>
<li><a href="../api/latest/#instanceofstring-function">instanceOfString</a></li>
</ul>
<p><strong>Example</strong></p>
<p>The following configuration converts the <code>roomNo</code> to <code>string</code> and adds a <code>messageID</code> to each event using the <code>convert</code> and <code>UUID</code> functions.
<pre class="codehilite"><code class="language-sql linenums">from TempStream
select convert(roomNo, 'string') as roomNo, temp, UUID() as messageID
insert into RoomTempStream;</code></pre></p>
<h3 id="filter">Filter<a class="headerlink" href="#filter" title="Permanent link">&para;</a></h3>
<p>Filters are included in queries to filter information from input streams based on a specified condition.</p>
<p><strong>Purpose</strong></p>
<p>A filter allows you to separate events that match a specific condition as the output, or for further processing.</p>
<p><strong>Syntax</strong></p>
<p>Filter conditions should be defined in square brackets next to the input stream name as shown below.</p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;[&lt;filter condition&gt;]
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p><strong>Example</strong></p>
<p>This query filters all server rooms of which the room number is within the range of 100-210, and having temperature greater than 40 degrees 
from the <code>TempStream</code> stream, and inserts the results into the <code>HighTempStream</code> stream.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream[(roomNo &gt;= 100 and roomNo &lt; 210) and temp &gt; 40]
select roomNo, temp
insert into HighTempStream;</code></pre>

<h3 id="window">Window<a class="headerlink" href="#window" title="Permanent link">&para;</a></h3>
<p>Windows allow you to capture a subset of events based on a specific criterion from an input stream for calculation. 
Each input stream can only have a maximum of one window.</p>
<p><strong>Purpose</strong></p>
<p>To create subsets of events within a stream based on time duration, number of events, etc for processing. 
A window can operate in a sliding or tumbling (batch) manner.</p>
<p><strong>Syntax</strong></p>
<p>The <code>#window</code> prefix should be inserted next to the relevant stream in order to use a window.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Filter condition can be applied both before and/or after the window</p>
</div>
<p><strong>Example</strong></p>
<p>If you want to identify the maximum temperature out of the last 10 events, you need to define a <code>length</code> window of 10 events.
 This window operates in a sliding mode where the following 3 subsets are calculated when a list of 12 events are received in a sequential order.</p>
<table>
<thead>
<tr>
<th>Subset</th>
<th>Event Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-10</td>
</tr>
<tr>
<td>2</td>
<td>2-11</td>
</tr>
<tr>
<td>3</td>
<td>3-12</td>
</tr>
</tbody>
</table>
<p>The following query finds the maximum temperature out of <strong>last 10 events</strong> from the <code>TempStream</code> stream, 
and inserts the results into the <code>MaxTempStream</code> stream.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.length(10)
select max(temp) as maxTemp
insert into MaxTempStream;</code></pre>

<p>If you define the maximum temperature reading out of every 10 events, you need to define a <code>lengthBatch</code> window of 10 events.
This window operates as a batch/tumbling mode where the following 3 subsets are calculated when a list of 30 events are received in a sequential order.</p>
<table>
<thead>
<tr>
<th>Subset</th>
<th>Event Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-10</td>
</tr>
<tr>
<td>2</td>
<td>11-20</td>
</tr>
<tr>
<td>3</td>
<td>21-30</td>
</tr>
</tbody>
</table>
<p>The following query finds the maximum temperature out of <strong>every 10 events</strong> from the <code>TempStream</code> stream, 
and inserts the results into the <code>MaxTempStream</code> stream.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.lengthBatch(10)
select max(temp) as maxTemp
insert into MaxTempStream;</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Similar operations can be done based on time via <code>time</code> windows and <code>timeBatch</code> windows and for others. 
Code segments such as <code>#window.time(10 min)</code> considers events that arrive during the last 10 minutes in a sliding manner, and the <code>#window.timeBatch(2 min)</code> considers events that arrive every 2 minutes in a tumbling manner. </p>
</div>
<p>Following are some inbuilt windows shipped with Siddhi. For more window types, see execution <a target="_blank" href="../extensions/">extensions</a>.</p>
<ul>
<li><a href="../api/latest/#time-window">time</a></li>
<li><a href="../api/latest/#timebatch-window">timeBatch</a></li>
<li><a href="../api/latest/#batch-window">batch</a></li>
<li><a href="../api/latest/#timelength-window">timeLength</a></li>
<li><a href="../api/latest/#length-window">length</a></li>
<li><a href="../api/latest/#lengthbatch-window">lengthBatch</a></li>
<li><a href="../api/latest/#sort-window">sort</a></li>
<li><a href="../api/latest/#frequent-window">frequent</a></li>
<li><a href="../api/latest/#lossyfrequent-window">lossyFrequent</a></li>
<li><a href="../api/latest/#session-window">session</a></li>
<li><a href="../api/latest/#cron-window">cron</a></li>
<li><a href="../api/latest/#externaltime-window">externalTime</a></li>
<li><a href="../api/latest/#externaltimebatch-window">externalTimeBatch</a></li>
<li><a href="../api/latest/#delay-window">delay</a></li>
</ul>
<p><strong>Output event types</strong><a id="output-event-types" class='anchor' aria-hidden='true'></a> </p>
<p>Projection of the query depends on the output event types such as, <code>current</code> and <code>expired</code> event types.
 By default all queries produce <code>current</code> events and only queries with windows produce <code>expired</code> events 
 when events expire from the window. You can specify whether the output of a query should be only current events, only expired events or both current and expired events.</p>
<p><strong>Note!</strong> Controlling the output event types does not alter the execution within the query, and it does not affect the accuracy of the query execution.  </p>
<p>The following keywords can be used with the output stream to manipulate output. </p>
<table>
<thead>
<tr>
<th>Output event types</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>current events</code></td>
<td>Outputs events when incoming events arrive to be processed by the query. </br> This is default when no specific output event type is specified.</td>
</tr>
<tr>
<td><code>expired events</code></td>
<td>Outputs events when events expires from the window.</td>
</tr>
<tr>
<td><code>all events</code></td>
<td>Outputs events when incoming events arrive to be processed by the query as well as </br> when events expire from the window.</td>
</tr>
</tbody>
</table>
<p>The output event type keyword can be used between <code>insert</code> and <code>into</code> as shown in the following example.</p>
<p><strong>Example</strong></p>
<p>This query delays all events in a stream by 1 minute.  </p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.time(1 min)
select *
insert expired events into DelayedTempStream</code></pre>

<h3 id="aggregate-function">Aggregate function<a class="headerlink" href="#aggregate-function" title="Permanent link">&para;</a></h3>
<p>Aggregate functions perform aggregate calculations in the query. 
When a window is defined the aggregation is restricted within that window. If no window is provided aggregation is performed from the start of the Siddhi application.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;(&lt;parameter&gt;, &lt;parameter&gt;, ... )
select &lt;aggregate function&gt;(&lt;parameter&gt;, &lt;parameter&gt;, ... ) as &lt;attribute name&gt;, &lt;attribute2 name&gt;, ...
insert into &lt;output stream&gt;;</code></pre>

<p><strong>Aggregate Parameters</strong></p>
<p>Aggregate parameters can be attributes, constant values, results of other functions or aggregates, results of mathematical or logical expressions, or time parameters. 
Aggregate parameters configured in a query  depends on the aggregate function being called.</p>
<p><strong>Example</strong></p>
<p>The following query calculates the average value for the <code>temp</code> attribute of the <code>TempStream</code> stream. This calculation is done for the last 10 minutes in a sliding manner, and the result is output as <code>avgTemp</code> to the <code>AvgTempStream</code> output stream.</p>
<p><pre class="codehilite"><code class="language-sql linenums">from TempStream#window.time(10 min)
select avg(temp) as avgTemp, roomNo, deviceID
insert into AvgTempStream;</code></pre>
Following are some inbuilt aggregation functions shipped with Siddhi, for more aggregation functions, see execution <a target="_blank" href="../extensions/">extensions</a>.</p>
<ul>
<li><a href="../api/latest/#avg-aggregate-function">avg</a></li>
<li><a href="../api/latest/#sum-aggregate-function">sum</a></li>
<li><a href="../api/latest/#max-aggregate-function">max</a></li>
<li><a href="../api/latest/#min-aggregate-function">min</a></li>
<li><a href="../api/latest/#count-aggregate-function">count</a></li>
<li><a href="../api/latest/#distinctcount-aggregate-function">distinctCount</a></li>
<li><a href="../api/latest/#maxforever-aggregate-function">maxForever</a></li>
<li><a href="../api/latest/#minforever-aggregate-function">minForever</a></li>
<li><a href="../api/latest/#stddev-aggregate-function">stdDev</a></li>
</ul>
<h3 id="group-by">Group By<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h3>
<p>Group By allows you to group the aggregate based on specified attributes.</p>
<p><strong>Syntax</strong>
The syntax for the Group By aggregate function is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;(...)
select &lt;aggregate function&gt;( &lt;parameter&gt;, &lt;parameter&gt;, ...) as &lt;attribute1 name&gt;, &lt;attribute2 name&gt;, ...
group by &lt;attribute1 name&gt;, &lt;attribute2 name&gt; ...
insert into &lt;output stream&gt;;</code></pre>

<p><strong>Example</strong>
The following query calculates the average temperature per <code>roomNo</code> and <code>deviceID</code> combination, for events that arrive at the <code>TempStream</code> stream
for a sliding time window of 10 minutes.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.time(10 min)
select avg(temp) as avgTemp, roomNo, deviceID
group by roomNo, deviceID
insert into AvgTempStream;</code></pre>

<h3 id="having">Having<a class="headerlink" href="#having" title="Permanent link">&para;</a></h3>
<p>Having allows you to filter events after processing the <code>select</code> statement.</p>
<p><strong>Purpose</strong>
This allows you to filter the aggregation output.</p>
<p><strong>Syntax</strong>
The syntax for the Having clause is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;( ... )
select &lt;aggregate function&gt;( &lt;parameter&gt;, &lt;parameter&gt;, ...) as &lt;attribute1 name&gt;, &lt;attribute2 name&gt;, ...
group by &lt;attribute1 name&gt;, &lt;attribute2 name&gt; ...
having &lt;condition&gt;
insert into &lt;output stream&gt;;</code></pre>

<p><strong>Example</strong></p>
<p>The following query calculates the average temperature per room for the last 10 minutes, and alerts if it exceeds 30 degrees.
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.time(10 min)
select avg(temp) as avgTemp, roomNo
group by roomNo
having avgTemp &gt; 30
insert into AlertStream;</code></pre></p>
<h3 id="order-by">Order By<a class="headerlink" href="#order-by" title="Permanent link">&para;</a></h3>
<p>Order By allows you to order the aggregated result in ascending and/or descending order based on specified attributes. By default ordering will be done in
ascending manner. User can use 'desc' keyword to order in descending manner.</p>
<p><strong>Syntax</strong>
The syntax for the Order By clause is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;( ... )
select &lt;aggregate function&gt;( &lt;parameter&gt;, &lt;parameter&gt;, ...) as &lt;attribute1 name&gt;, &lt;attribute2 name&gt;, ...
group by &lt;attribute1 name&gt;, &lt;attribute2 name&gt; ...
having &lt;condition&gt;
order by &lt;attribute1 name&gt; (asc | desc)?, &lt;attribute2 name&gt; (&lt;ascend/descend&gt;)?, ...
insert into &lt;output stream&gt;;</code></pre>

<p><strong>Example</strong></p>
<p>The following query calculates the average temperature per <code>roomNo</code> and <code>deviceID</code> combination for every 10 minutes, and generate output events
by ordering them in the ascending order of the room's avgTemp and then by the descending order of roomNo.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.timeBatch(10 min)
select avg(temp) as avgTemp, roomNo, deviceID
group by roomNo, deviceID
order by avgTemp, roomNo desc
insert into AvgTempStream;</code></pre>

<h3 id="limit-offset">Limit &amp; Offset<a class="headerlink" href="#limit-offset" title="Permanent link">&para;</a></h3>
<p>When events are emitted as a batch, offset allows you to offset beginning of the output event batch and limit allows you to limit the number of events in the batch from the defined offset. 
With this users can specify which set of events need be emitted. </p>
<p><strong>Syntax</strong>
The syntax for the Limit &amp; Offset clause is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;( ... )
select &lt;aggregate function&gt;( &lt;parameter&gt;, &lt;parameter&gt;, ...) as &lt;attribute1 name&gt;, &lt;attribute2 name&gt;, ...
group by &lt;attribute1 name&gt;, &lt;attribute2 name&gt; ...
having &lt;condition&gt;
order by &lt;attribute1 name&gt; (asc | desc)?, &lt;attribute2 name&gt; (&lt;ascend/descend&gt;)?, ...
limit &lt;positive interger&gt;?
offset &lt;positive interger&gt;?
insert into &lt;output stream&gt;;</code></pre>

<p>Here both <code>limit</code> and <code>offset</code> are optional where <code>limit</code> by default output all the events and <code>offset</code> by default set to <code>0</code>.</p>
<p><strong>Example</strong>
The following query calculates the average temperature per <code>roomNo</code> and <code>deviceID</code> combination, for events that arrive at the <code>TempStream</code> stream
for every 10 minutes and emits two events with highest average temperature.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.timeBatch(10 min)
select avg(temp) as avgTemp, roomNo, deviceID
group by roomNo, deviceID
order by avgTemp desc
limit 2
insert into HighestAvgTempStream;</code></pre>

<p>The following query calculates the average temperature per <code>roomNo</code> and <code>deviceID</code> combination, for events that arrive at the <code>TempStream</code> stream
for every 10 minutes and emits third, forth and fifth events when sorted in descending order based on their average temperature.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream#window.timeBatch(10 min)
select avg(temp) as avgTemp, roomNo, deviceID
group by roomNo, deviceID
order by avgTemp desc
limit 3
offset 2
insert into HighestAvgTempStream;</code></pre>

<h3 id="join-stream">Join (Stream)<a class="headerlink" href="#join-stream" title="Permanent link">&para;</a></h3>
<p>Joins allow you to get a combined result from two streams in real-time based on a specified condition. </p>
<p><strong>Purpose</strong>
Streams are stateless. Therefore, in order to join two streams, they need to be connected to a window so that there is a pool of events that can be used for joining. Joins also accept conditions to join the appropriate events from each stream.</p>
<p>During the joining process each incoming event of each stream is matched against all the events in the other 
stream's window based on the given condition, and the output events are generated for all the matching event pairs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Join can also be performed with <a href="#join-table">stored data</a>, <a href="#join-aggregation">aggregation</a> or externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<p>The syntax for a join is as follows:</p>
<p><pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;#window.&lt;window name&gt;(&lt;parameter&gt;, ... ) {unidirectional} {as &lt;reference&gt;}
         join &lt;input stream&gt;#window.&lt;window name&gt;(&lt;parameter&gt;,  ... ) {unidirectional} {as &lt;reference&gt;}
    on &lt;join condition&gt;
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>
Here, the <code>&lt;join condition&gt;</code> allows you to match the attributes from both the streams. </p>
<p><strong>Unidirectional join operation</strong></p>
<p>By default, events arriving at either stream can trigger the joining process. However, if you want to control the 
join execution, you can add the <code>unidirectional</code> keyword next to a stream in the join definition as depicted in the 
syntax in order to enable that stream to trigger the join operation. Here, events arriving at other stream only update the 
 window of that stream, and this stream does not trigger the join operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>unidirectional</code> keyword cannot be applied to both the input streams because the default behaviour already allows both streams to trigger the join operation.</p>
</div>
<p><strong>Example</strong></p>
<p>Assuming that the temperature of regulators are updated every minute. 
Following is a Siddhi App that controls the temperature regulators if they are not already <code>on</code> for all the rooms with a room temperature greater than 30 degrees.  </p>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream(deviceID long, roomNo int, temp double);
define stream RegulatorStream(deviceID long, roomNo int, isOn bool);

from TempStream[temp &gt; 30.0]#window.time(1 min) as T
  join RegulatorStream[isOn == false]#window.length(1) as R
  on T.roomNo == R.roomNo
select T.roomNo, R.deviceID, 'start' as action
insert into RegulatorActionStream;</code></pre>

<p><strong>Supported join types</strong> </p>
<p>Following are the supported operations of a join clause.</p>
<ul>
<li>
<p><strong>Inner join (join)</strong> </p>
<p>This is the default behaviour of a join operation. <code>join</code> is used as the keyword to join both the streams. The output is generated only if there is a matching event in both the streams.</p>
</li>
<li>
<p><strong>Left outer join</strong> </p>
<p>The <code>left outer join</code> operation allows you to join two streams to be merged based on a condition. <code>left outer join</code> is used as the keyword to join both the streams.</p>
<p>Here, it returns all the events of left stream even if there are no matching events in the right stream by 
having null values for the attributes of the right stream.</p>
<p><strong>Example</strong></p>
<p>The following query generates output events for all events from the <code>StockStream</code> stream regardless of whether a matching 
symbol exists in the <code>TwitterStream</code> stream or not.</p>
<p><pre>
from StockStream#window.time(1 min) as S
  left outer join TwitterStream#window.length(1) as T
  on S.symbol== T.symbol
select S.symbol as symbol, T.tweet, S.price
insert into outputStream ;    </pre></p>
</li>
<li>
<p><strong>Right outer join</strong> </p>
<p>This is similar to a left outer join. <code>Right outer join</code> is used as the keyword to join both the streams.
It returns all the events of the right stream even if there are no matching events in the left stream. </p>
</li>
<li>
<p><strong>Full outer join</strong> </p>
<p>The full outer join combines the results of left outer join and right outer join. <code>full outer join</code> is used as the keyword to join both the streams.
Here, output event are generated for each incoming event even if there are no matching events in the other stream.</p>
<p><strong>Example</strong></p>
<p>The following query generates output events for all the incoming events of each stream regardless of whether there is a 
match for the <code>symbol</code> attribute in the other stream or not.</p>
<p><pre>
from StockStream#window.time(1 min) as S
  full outer join TwitterStream#window.length(1) as T
  on S.symbol== T.symbol
select S.symbol as symbol, T.tweet, S.price
insert into outputStream ;    </pre></p>
</li>
</ul>
<h3 id="pattern">Pattern<a class="headerlink" href="#pattern" title="Permanent link">&para;</a></h3>
<p>This is a state machine implementation that allows you to detect patterns in the events that arrive over time. This can correlate events within a single stream or between multiple streams. </p>
<p><strong>Purpose</strong> </p>
<p>Patterns allow you to identify trends in events over a time period.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a pattern query:</p>
<p><pre class="codehilite"><code class="language-sql linenums">from (every)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;] -&gt; 
    (every)? &lt;event reference&gt;=&lt;input stream [&lt;filter condition&gt;] -&gt; 
    ... 
    (within &lt;time gap&gt;)?     
select &lt;event reference&gt;.&lt;attribute name&gt;, &lt;event reference&gt;.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>
| Items| Description |
|-------------------|-------------|
| <code>-&gt;</code> | This is used to indicate an event that should be following another event. The subsequent event does not necessarily have to occur immediately after the preceding event. The condition to be met by the preceding event should be added before the sign, and the condition to be met by the subsequent event should be added after the sign. |
| <code>&lt;event reference&gt;</code> | This allows you to add a reference to the the matching event so that it can be accessed later for further processing. |
| <code>(within &lt;time gap&gt;)?</code> | The <code>within</code> clause is optional. It defines the time duration within which all the matching events should occur. |
| <code>every</code> | <code>every</code> is an optional keyword. This defines whether the event matching should be triggered for every event arrival in the specified stream with the matching condition. <br/> When this keyword is not used, the matching is carried out only once. |</p>
<p>Siddhi also supports pattern matching with counting events and matching events in a logical order such as (<code>and</code>, <code>or</code>, and <code>not</code>). These are described in detail further below in this guide.</p>
<p><strong>Example</strong></p>
<p>This query sends an alert if the temperature of a room increases by 5 degrees within 10 min.</p>
<pre class="codehilite"><code class="language-sql linenums">from every( e1=TempStream ) -&gt; e2=TempStream[ e1.roomNo == roomNo and (e1.temp + 5) &lt;= temp ]
    within 10 min
select e1.roomNo, e1.temp as initialTemp, e2.temp as finalTemp
insert into AlertStream;</code></pre>

<p>Here, the matching process begins for each event in the <code>TempStream</code> stream (because <code>every</code> is used with <code>e1=TempStream</code>), 
and if  another event arrives within 10 minutes with a value for the <code>temp</code> attribute that is greater than or equal to <code>e1.temp + 5</code> 
of the event e1, an output is generated via the <code>AlertStream</code>.</p>
<h4 id="counting-pattern">Counting Pattern<a class="headerlink" href="#counting-pattern" title="Permanent link">&para;</a></h4>
<p>Counting patterns allow you to match multiple events that may have been received for the same matching condition.
The number of events matched per condition can be limited via condition postfixes.</p>
<p><strong>Syntax</strong></p>
<p>Each matching condition can contain a collection of events with the minimum and maximum number of events to be matched as shown in the syntax below. </p>
<pre class="codehilite"><code class="language-sql linenums">from (every)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;] (&lt;&lt;min count&gt;:&lt;max count&gt;&gt;)? -&gt;  
    ... 
    (within &lt;time gap&gt;)?     
select &lt;event reference&gt;([event index])?.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<table>
<thead>
<tr>
<th>Postfix</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;n1:n2&gt;</code></td>
<td>This matches <code>n1</code> to <code>n2</code> events (including <code>n1</code> and not more than <code>n2</code>).</td>
<td><code>1:4</code> matches 1 to 4 events.</td>
</tr>
<tr>
<td><code>&lt;n:&gt;</code></td>
<td>This matches <code>n</code> or more events (including <code>n</code>).</td>
<td><code>&lt;2:&gt;</code> matches 2 or more events.</td>
</tr>
<tr>
<td><code>&lt;:n&gt;</code></td>
<td>This matches up to <code>n</code> events (excluding <code>n</code>).</td>
<td><code>&lt;:5&gt;</code> matches up to 5 events.</td>
</tr>
<tr>
<td><code>&lt;n&gt;</code></td>
<td>This matches exactly <code>n</code> events.</td>
<td><code>&lt;5&gt;</code> matches exactly 5 events.</td>
</tr>
</tbody>
</table>
<p>Specific occurrences of the event in a collection can be retrieved by using an event index with its reference.
Square brackets can be used to indicate the event index where <code>1</code> can be used as the index of the first event and <code>last</code> can be used as the index
 for the <code>last</code> available event in the event collection. If you provide an index greater then the last event index,
 the system returns <code>null</code>. The following are some valid examples.</p>
<ul>
<li><code>e1[3]</code> refers to the 3<sup>rd</sup> event.</li>
<li><code>e1[last]</code> refers to the last event.</li>
<li><code>e1[last - 1]</code> refers to the event before the last event.</li>
</ul>
<p><strong>Example</strong></p>
<p>The following Siddhi App calculates the temperature difference between two regulator events.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream (deviceID long, roomNo int, temp double);
define stream RegulatorStream (deviceID long, roomNo int, tempSet double, isOn bool);

from every( e1=RegulatorStream) -&gt; e2=TempStream[e1.roomNo==roomNo]&lt;1:&gt; -&gt; e3=RegulatorStream[e1.roomNo==roomNo]
select e1.roomNo, e2[0].temp - e2[last].temp as tempDiff
insert into TempDiffStream;</code></pre>

<h4 id="logical-patterns">Logical Patterns<a class="headerlink" href="#logical-patterns" title="Permanent link">&para;</a></h4>
<p>Logical patterns match events that arrive in temporal order and correlate them with logical relationships such as <code>and</code>, 
<code>or</code> and <code>not</code>. </p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from (every)? (not)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;] 
          ((and|or) &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;])? (within &lt;time gap&gt;)? -&gt;  
    ... 
select &lt;event reference&gt;([event index])?.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p>Keywords such as <code>and</code>, <code>or</code>, or <code>not</code> can be used to illustrate the logical relationship.</p>
<table>
<thead>
<tr>
<th>Key Word</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>and</code></td>
<td>This allows both conditions of <code>and</code> to be matched by two events in any order.</td>
</tr>
<tr>
<td><code>or</code></td>
<td>The state succeeds if either condition of <code>or</code> is satisfied. Here the event reference of the other condition is <code>null</code>.</td>
</tr>
<tr>
<td><code>not &lt;condition1&gt; and &lt;condition2&gt;</code></td>
<td>When <code>not</code> is included with <code>and</code>, it identifies the events that match <condition2> arriving before any event that match <condition1>.</td>
</tr>
<tr>
<td><code>not &lt;condition&gt; for &lt;time period&gt;</code></td>
<td>When <code>not</code> is included with <code>for</code>, it allows you to identify a situation where no event that matches <code>&lt;condition1&gt;</code> arrives during the specified <code>&lt;time period&gt;</code>.  e.g.,<code>from not TemperatureStream[temp &gt; 60] for 5 sec</code>.</td>
</tr>
</tbody>
</table>
<p>Here the <code>not</code> pattern can be followed by either an <code>and</code> clause or the effective period of <code>not</code> can be concluded after a given <code>&lt;time period&gt;</code>. Further in Siddhi more than two streams cannot be matched with logical conditions using <code>and</code>, <code>or</code>, or <code>not</code> clauses at this point.</p>
<h5 id="detecting-non-occurring-events">Detecting Non-occurring Events<a class="headerlink" href="#detecting-non-occurring-events" title="Permanent link">&para;</a></h5>
<p>Siddhi allows you to detect non-occurring events via multiple combinations of the key words specified above as shown in the table below.</p>
<p>In the patterns listed, P* can be either a regular event pattern, an absent event pattern or a logical pattern.</p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Detected Scenario</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>not A for &lt;time period&gt;</code></td>
<td>The non-occurrence of event A within <code>&lt;time period&gt;</code> after system start up.<br/> e.g., Generating an alert if a taxi has not reached its destination within 30 minutes, to indicate that the passenger might be in danger.</td>
</tr>
<tr>
<td><code>not A for &lt;time period&gt; and B</code></td>
<td>After system start up, event A does not occur within <code>time period</code>, but event B occurs at some point in time. <br/> e.g., Generating an alert if a taxi has not reached its destination within 30 minutes, and the passenger marked that he/she is in danger at some point in time.</td>
</tr>
<tr>
<td><code>not A for &lt;time period 1&gt; and not B for &lt;time period 2&gt;</code></td>
<td>After system start up, event A doess not occur within <code>time period 1</code>, and event B also does not occur within <code>&lt;time period 2&gt;</code>. <br/> e.g., Generating an alert if the driver of a taxi has not reached the destination within 30 minutes, and the passenger has not marked himself/herself to be in danger within that same time period.</td>
</tr>
<tr>
<td><code>not A for &lt;time period&gt; or B</code></td>
<td>After system start up, either event A does not occur within <code>&lt;time period&gt;</code>, or event B occurs at some point in time. <br/> e.g., Generating an alert if the taxi has not reached its destination within 30 minutes, or if the passenger has marked that he/she is in danger at some point in time.</td>
</tr>
<tr>
<td><code>not A for &lt;time period 1&gt; or not B for &lt;time period 2&gt;</code></td>
<td>After system start up, either event A does not occur within <code>&lt;time period 1&gt;</code>, or event B occurs within <code>&lt;time period 2&gt;</code>. <br/> e.g., Generating an alert to indicate that the driver is not on an expected route if the taxi has not reached destination A within 20 minutes, or reached destination B within 30 minutes.</td>
</tr>
<tr>
<td><code>A → not B for &lt;time period&gt;</code></td>
<td>Event B does not occur within <code>&lt;time period&gt;</code> after the occurrence of event A. e.g., Generating an alert if the taxi has reached its destination, but this was not followed by a payment record.</td>
</tr>
<tr>
<td><code>P* → not A for &lt;time period&gt; and B</code></td>
<td>After the occurrence of P*, event A does not occur within <code>&lt;time period&gt;</code>, and event B occurs at some point in time. <br/></td>
</tr>
<tr>
<td><code>P* → not A for &lt;time period 1&gt; and not B for &lt;time period 2&gt;</code></td>
<td>After the occurrence of P*, event A does not occur within <code>&lt;time period 1&gt;</code>, and event B does not occur within <code>&lt;time period 2&gt;</code>.</td>
</tr>
<tr>
<td><code>P* → not A for &lt;time period&gt; or B</code></td>
<td>After the occurrence of P*, either event A does not occur within <code>&lt;time period&gt;</code>, or event B occurs at some point in time.</td>
</tr>
<tr>
<td><code>P* → not A for &lt;time period 1&gt; or not B for &lt;time period 2&gt;</code></td>
<td>After the occurrence of P*, either event A does not occur within <code>&lt;time period 1&gt;</code>, or event B does not occur within <code>&lt;time period 2&gt;</code>.</td>
</tr>
<tr>
<td><code>not A for &lt;time period&gt; → B</code></td>
<td>Event A does occur within <code>&lt;time period&gt;</code> after the system start up, but event B occurs after that <code>&lt;time period&gt;</code> has elapsed.</td>
</tr>
<tr>
<td><code>not A for &lt;time period&gt; and B → P*</code></td>
<td>Event A does not occur within <code>&lt;time period&gt;</code>, and event B occurs at some point in time. Then P* occurs after the <code>&lt;time period&gt;</code> has elapsed, and after B has occurred.</td>
</tr>
<tr>
<td><code>not A for &lt;time period 1&gt; and not B for &lt;time period 2&gt; → P*</code></td>
<td>After system start up, event A does not occur within <code>&lt;time period 1&gt;</code>, and event B does not occur within <code>&lt;time period 2&gt;</code>. However, P* occurs after both A and B.</td>
</tr>
<tr>
<td><code>not A for &lt;time period&gt; or B → P*</code></td>
<td>After system start up, event A does not occur within <code>&lt;time period&gt;</code> or event B occurs at some point in time. The P* occurs after <code>&lt;time period&gt;</code> has elapsed, or after B has occurred.</td>
</tr>
<tr>
<td><code>not A for &lt;time period 1&gt; or not B for &lt;time period 2&gt; → P*</code></td>
<td>After system start up, either event A does not occur within <code>&lt;time period 1&gt;</code>, or event B does not occur within <code>&lt;time period 2&gt;</code>. Then P*  occurs after both <code>&lt;time period 1&gt;</code> and <code>&lt;time period 2&gt;</code> have elapsed.</td>
</tr>
<tr>
<td><code>not A and B</code></td>
<td>Event A does not occur before event B.</td>
</tr>
<tr>
<td><code>A and not B</code></td>
<td>Event B does not occur before event A.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>Following Siddhi App, sends the <code>stop</code> control action to the regulator when the key is removed from the hotel room. 
<pre class="codehilite"><code class="language-sql linenums">define stream RegulatorStateChangeStream(deviceID long, roomNo int, tempSet double, action string);
define stream RoomKeyStream(deviceID long, roomNo int, action string);


from every( e1=RegulatorStateChangeStream[ action == 'on' ] ) -&gt; 
      e2=RoomKeyStream[ e1.roomNo == roomNo and action == 'removed' ] or e3=RegulatorStateChangeStream[ e1.roomNo == roomNo and action == 'off']
select e1.roomNo, ifThenElse( e2 is null, 'none', 'stop' ) as action
having action != 'none'
insert into RegulatorActionStream;</code></pre></p>
<p>This Siddhi Application generates an alert if we have switch off the regulator before the temperature reaches 12 degrees.  </p>
<pre class="codehilite"><code class="language-sql linenums">define stream RegulatorStateChangeStream(deviceID long, roomNo int, tempSet double, action string);
define stream TempStream (deviceID long, roomNo int, temp double);

from e1=RegulatorStateChangeStream[action == 'start'] -&gt; not TempStream[e1.roomNo == roomNo and temp &lt; 12] and e2=RegulatorStateChangeStream[action == 'off']
select e1.roomNo as roomNo
insert into AlertStream;</code></pre>

<p>This Siddhi Application generates an alert if the temperature does not reduce to 12 degrees within 5 minutes of switching on the regulator.  </p>
<pre class="codehilite"><code class="language-sql linenums">define stream RegulatorStateChangeStream(deviceID long, roomNo int, tempSet double, action string);
define stream TempStream (deviceID long, roomNo int, temp double);

from e1=RegulatorStateChangeStream[action == 'start'] -&gt; not TempStream[e1.roomNo == roomNo and temp &lt; 12] for '5 min'
select e1.roomNo as roomNo
insert into AlertStream;</code></pre>

<h3 id="sequence">Sequence<a class="headerlink" href="#sequence" title="Permanent link">&para;</a></h3>
<p>Sequence is a state machine implementation that allows you to detect the sequence of event occurrences over time. 
Here <strong>all matching events need to arrive consecutively</strong> to match the sequence condition, and there cannot be any non-matching events arriving within a matching sequence of events.
This can correlate events within a single stream or between multiple streams. </p>
<p><strong>Purpose</strong> </p>
<p>This allows you to detect a specified event sequence over a specified time period. </p>
<p><strong>Syntax</strong></p>
<p>The syntax for a sequence query is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from (every)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;], 
    &lt;event reference&gt;=&lt;input stream [&lt;filter condition&gt;], 
    ... 
    (within &lt;time gap&gt;)?     
select &lt;event reference&gt;.&lt;attribute name&gt;, &lt;event reference&gt;.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<table>
<thead>
<tr>
<th>Items</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>,</code></td>
<td>This represents the immediate next event i.e., when an event that matches the first condition arrives, the event that arrives immediately after it should match the second condition.</td>
</tr>
<tr>
<td><code>&lt;event reference&gt;</code></td>
<td>This allows you to add a reference to the the matching event so that it can be accessed later for further processing.</td>
</tr>
<tr>
<td><code>(within &lt;time gap&gt;)?</code></td>
<td>The <code>within</code> clause is optional. It defines the time duration within which all the matching events should occur.</td>
</tr>
<tr>
<td><code>every</code></td>
<td><code>every</code> is an optional keyword. This defines whether the matching event should be triggered for every event that arrives at the specified stream with the matching condition. <br/> When this keyword is not used, the matching is carried out only once.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>This query generates an alert if the increase in the temperature between two consecutive temperature events exceeds one degree.</p>
<pre class="codehilite"><code class="language-sql linenums">from every e1=TempStream, e2=TempStream[e1.temp + 1 &lt; temp]
select e1.temp as initialTemp, e2.temp as finalTemp
insert into AlertStream;</code></pre>

<p><strong>Counting Sequence</strong></p>
<p>Counting sequences allow you to match multiple events for the same matching condition.
The number of events matched per condition can be limited via condition postfixes such as <strong>Counting Patterns</strong>, or by using the 
<code>*</code>, <code>+</code>, and <code>?</code> operators.</p>
<p>The matching events can also be retrieved using event indexes, similar to how it is done in <strong>Counting Patterns</strong>.</p>
<p><strong>Syntax</strong></p>
<p>Each matching condition in a sequence can contain a collection of events as shown below. </p>
<pre class="codehilite"><code class="language-sql linenums">from (every)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;](+|*|?)?, 
    &lt;event reference&gt;=&lt;input stream [&lt;filter condition&gt;](+|*|?)?, 
    ... 
    (within &lt;time gap&gt;)?     
select &lt;event reference&gt;.&lt;attribute name&gt;, &lt;event reference&gt;.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<table>
<thead>
<tr>
<th>Postfix symbol</th>
<th>Required/Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>Optional</td>
<td>This matches <strong>one or more</strong> events to the given condition.</td>
</tr>
<tr>
<td><code>*</code></td>
<td>Optional</td>
<td>This matches <strong>zero or more</strong> events to the given condition.</td>
</tr>
<tr>
<td><code>?</code></td>
<td>Optional</td>
<td>This matches <strong>zero or one</strong> events to the given condition.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>This Siddhi application identifies temperature peeks.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream(deviceID long, roomNo int, temp double);

from every e1=TempStream, e2=TempStream[e1.temp &lt;= temp]+, e3=TempStream[e2[last].temp &gt; temp]
select e1.temp as initialTemp, e2[last].temp as peakTemp
insert into PeekTempStream;</code></pre>

<p><strong>Logical Sequence</strong></p>
<p>Logical sequences identify logical relationships using <code>and</code>, <code>or</code> and <code>not</code> on consecutively arriving events.</p>
<p><strong>Syntax</strong>
The syntax for a logical sequence is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from (every)? (not)? &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;] 
          ((and|or) &lt;event reference&gt;=&lt;input stream&gt;[&lt;filter condition&gt;])? (within &lt;time gap&gt;)?, 
    ... 
select &lt;event reference&gt;([event index])?.&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p>Keywords such as <code>and</code>, <code>or</code>, or <code>not</code> can be used to illustrate the logical relationship, similar to how it is done in <strong>Logical Patterns</strong>. </p>
<p><strong>Example</strong></p>
<p>This Siddhi application notifies the state when a regulator event is immediately followed by both temperature and humidity events. </p>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream(deviceID long, temp double);
define stream HumidStream(deviceID long, humid double);
define stream RegulatorStream(deviceID long, isOn bool);

from every e1=RegulatorStream, e2=TempStream and e3=HumidStream
select e2.temp, e3.humid
insert into StateNotificationStream;</code></pre>

<h3 id="output-rate-limiting">Output rate limiting<a class="headerlink" href="#output-rate-limiting" title="Permanent link">&para;</a></h3>
<p>Output rate limiting allows queries to output events periodically based on a specified condition.</p>
<p><strong>Purpose</strong></p>
<p>This allows you to limit the output to avoid overloading the subsequent executions, and to remove unnecessary information.</p>
<p><strong>Syntax</strong></p>
<p>The syntax of an output rate limiting configuration is as follows:</p>
<p><pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; ...
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
output &lt;rate limiting configuration&gt;
insert into &lt;output stream&gt;</code></pre>
Siddhi supports three types of output rate limiting configurations as explained in the following table: </p>
<table>
<thead>
<tr>
<th>Rate limiting configuration</th>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Based on time</td>
<td><code>&lt;output event&gt; every &lt;time interval&gt;</code></td>
<td>This outputs <code>&lt;output event&gt;</code> every <code>&lt;time interval&gt;</code> time interval.</td>
</tr>
<tr>
<td>Based on number of events</td>
<td><code>&lt;output event&gt; every &lt;event interval&gt; events</code></td>
<td>This outputs <code>&lt;output event&gt;</code> for every <code>&lt;event interval&gt;</code> number of events.</td>
</tr>
<tr>
<td>Snapshot based output</td>
<td><code>snapshot every &lt;time interval&gt;</code></td>
<td>This outputs all events in the window (or the last event if no window is defined in the query) for every given <code>&lt;time interval&gt;</code> time interval.</td>
</tr>
</tbody>
</table>
<p>Here the <code>&lt;output event&gt;</code> specifies the event(s) that should be returned as the output of the query. 
The possible values are as follows:
* <code>first</code> : Only the first event processed by the query during the specified time interval/sliding window is emitted.
* <code>last</code> : Only the last event processed by the query during the specified time interval/sliding window is emitted.
* <code>all</code> : All the events processed by the query during the specified time interval/sliding window are emitted. <strong>When no <code>&lt;output event&gt;</code> is defined, <code>all</code> is used by default.</strong></p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Returning events based on the number of events</p>
<p>Here, events are emitted every time the specified number of events arrive. You can also specify whether to emit only the first event/last event, or all the events out of the events that arrived.</p>
<p>In this example, the last temperature per sensor is emitted for every 10 events.</p>
<p><pre>
from TempStreamselect 
select temp, deviceID
group by deviceID
output last every 10 events
insert into LowRateTempStream;    </pre></p>
</li>
<li>
<p>Returning events based on time</p>
<p>Here events are emitted for every predefined time interval. You can also specify whether to emit only the first event, last event, or all events out of the events that arrived during the specified time interval.</p>
<p>In this example, emits all temperature events every 10 seconds  </p>
<p><pre>
from TempStreamoutput 
output every 10 sec
insert into LowRateTempStream;    </pre></p>
</li>
<li>
<p>Returning a periodic snapshot of events</p>
<p>This method works best with windows. When an input stream is connected to a window, snapshot rate limiting emits all the current events that have arrived and do not have corresponding expired events for every predefined time interval. 
If the input stream is not connected to a window, only the last current event for each predefined time interval is emitted.</p>
<p>This query emits a snapshot of the events in a time window of 5 seconds every 1 second. </p>
<p><pre>
from TempStream#window.time(5 sec)
output snapshot every 1 sec
insert into SnapshotTempStream;    </pre></p>
</li>
</ul>
<h2 id="partition">Partition<a class="headerlink" href="#partition" title="Permanent link">&para;</a></h2>
<p>Partitions divide streams and queries into isolated groups in  order to process them in parallel and in isolation. 
A partition can contain one or more queries and there can be multiple instances where the same queries and streams are replicated for each partition. 
Each partition is tagged with a partition key. Those partitions only process the events that match the corresponding partition key. </p>
<p><strong>Purpose</strong> </p>
<p>Partitions allow you to process the events groups in isolation so that event processing can be performed using the same set of queries for each group. </p>
<p><strong>Partition key generation</strong></p>
<p>A partition key can be generated in the following two methods:</p>
<ul>
<li>
<p>Partition by value</p>
<p>This is created by generating unique values using input stream attributes.</p>
<p><strong>Syntax</strong></p>
<p><pre>
partition with ( &lt;expression&gt; of &lt;stream name&gt;, &lt;expression&gt; of &lt;stream name&gt;, ... )
begin
    &lt;query&gt;
    &lt;query&gt;
    ...
end; </pre></p>
<p><strong>Example</strong></p>
<p>This query calculates the maximum temperature recorded within the last 10 events per <code>deviceID</code>.</p>
<p><pre>
partition with ( deviceID of TempStream )
begin
    from TempStream#window.length(10)
    select roomNo, deviceID, max(temp) as maxTemp
    insert into DeviceTempStream;
end;
</pre></p>
</li>
<li>
<p>Partition by range</p>
<p>This is created by mapping each partition key to a range condition of the input streams numerical attribute.</p>
<p><strong>Syntax</strong></p>
<p><pre>
partition with ( &lt;condition&gt; as &lt;partition key&gt; or &lt;condition&gt; as &lt;partition key&gt; or ... of &lt;stream name&gt;, ... )
begin
    &lt;query&gt;
    &lt;query&gt;
    ...
end;
</pre></p>
<p><strong>Example</strong></p>
<p>This query calculates the average temperature for the last 10 minutes per office area.</p>
<p><pre>
partition with ( roomNo &gt;= 1030 as 'serverRoom' or 
                 roomNo &lt; 1030 and roomNo &gt;= 330 as 'officeRoom' or 
                 roomNo &lt; 330 as 'lobby' of TempStream)
begin
    from TempStream#window.time(10 min)
    select roomNo, deviceID, avg(temp) as avgTemp
    insert into AreaTempStream
end;
</pre>  </p>
</li>
</ul>
<h3 id="inner-stream">Inner Stream<a class="headerlink" href="#inner-stream" title="Permanent link">&para;</a></h3>
<p>Queries inside a partition block can use inner streams to communicate with each other while preserving partition isolation.
Inner streams are denoted by a "#" placed before the stream name, and these streams cannot be accessed outside a partition block. </p>
<p><strong>Purpose</strong></p>
<p>Inner streams allow you to connect queries within the partition block so that the output of a query can be used as an input only by another query 
within the same partition. Therefore, you do not need to repartition the streams if they are communicating within the partition.</p>
<p><strong>Example</strong></p>
<p>This partition calculates the average temperature of every 10 events for each sensor, and sends an output to the <code>DeviceTempIncreasingStream</code> stream if the consecutive average temperature values increase by more than 
5 degrees.</p>
<pre>
partition with ( deviceID of TempStream )
begin
    from TempStream#window.lengthBatch(10)
    select roomNo, deviceID, avg(temp) as avgTemp
    insert into #AvgTempStream

    from every (e1=#AvgTempStream),e2=#AvgTempStream[e1.avgTemp + 5 < avgTemp]
    select e1.deviceID, e1.avgTemp as initialAvgTemp, e2.avgTemp as finalAvgTemp
    insert into DeviceTempIncreasingStream
end;
</pre>

<h2 id="table">Table<a class="headerlink" href="#table" title="Permanent link">&para;</a></h2>
<p>A table is a stored version of an stream or a table of events. Its schema is defined via the <strong>table definition</strong> that is
similar to a stream definition. These events are by default stored <code>in-memory</code>, but Siddhi also provides store extensions to work with data/events stored in various data stores through the 
table abstraction.</p>
<p><strong>Purpose</strong></p>
<p>Tables allow Siddhi to work with stored events. By defining a schema for tables Siddhi enables them to be processed by queries using their defined attributes with the streaming data. You can also interactively query the state of the stored events in the table.</p>
<p><strong>Syntax</strong></p>
<p>The syntax for a new table definition is as follows:</p>
<p><pre class="codehilite"><code class="language-sql linenums">define table &lt;table name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... );</code></pre>
The following parameters are configured in a table definition:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>table name</code></td>
<td>The name of the table defined. (<code>PascalCase</code> is used for table name as a convention.)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of the table is defined by its attributes with uniquely identifiable attribute names (<code>camelCase</code> is used for attribute names as a convention.)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>The following defines a table named <code>RoomTypeTable</code> with <code>roomNo</code> and <code>type</code> attributes of data types <code>int</code> and <code>string</code> respectively.</p>
<pre class="codehilite"><code class="language-sql linenums">define table RoomTypeTable ( roomNo int, type string );</code></pre>

<p><strong>Primary Keys</strong></p>
<p>Tables can be configured with primary keys to avoid the duplication of data. </p>
<p>Primary keys are configured by including the <code>@PrimaryKey( 'key1', 'key2' )</code> annotation to the table definition. 
Each event table configuration can have only one <code>@PrimaryKey</code> annotation. 
The number of attributes supported differ based on the table implementations. When more than one attribute 
 is used for the primary key, the uniqueness of the events stored in the table is determined based on the combination of values for those attributes.</p>
<p><strong>Examples</strong></p>
<p>This query creates an event table with the <code>symbol</code> attribute as the primary key. 
Therefore each entry in this table must have a unique value for <code>symbol</code> attribute.</p>
<pre class="codehilite"><code class="language-sql linenums">@PrimaryKey('symbol')
define table StockTable (symbol string, price float, volume long);</code></pre>

<p><strong>Indexes</strong></p>
<p>Indexes allow tables to be searched/modified much faster. </p>
<p>Indexes are configured by including the <code>@Index( 'key1', 'key2' )</code> annotation to the table definition.
 Each event table configuration can have 0-1 <code>@Index</code> annotations. 
 Support for the <code>@Index</code> annotation and the number of attributes supported differ based on the table implementations. 
 When more then one attribute is used for index, each one of them is used to index the table for fast access of the data. 
 Indexes can be configured together with primary keys. </p>
<p><strong>Examples</strong></p>
<p>This query creates an indexed event table named <code>RoomTypeTable</code> with the <code>roomNo</code> attribute as the index key.</p>
<pre class="codehilite"><code class="language-sql linenums">@Index('roomNo')
define table RoomTypeTable (roomNo int, type string);</code></pre>

<h3 id="store">Store<a class="headerlink" href="#store" title="Permanent link">&para;</a></h3>
<p>Store is a table that refers to data/events stored in data stores outside of Siddhi such as RDBMS, Cassandra, etc. 
Store is defined via the <code>@store</code> annotation, and the store schema is defined via a <strong>table definition</strong> associated with it.</p>
<p><strong>Purpose</strong></p>
<p>Store allows Siddhi to search, retrieve and manipulate data stored in external data stores through Siddhi queries. </p>
<p><strong>Syntax</strong></p>
<p>The syntax for a defining store and it's associated table definition is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">@store(type='store_type', static.option.key1='static_option_value1', static.option.keyN='static_option_valueN')
define table TableName (attribute1 Type1, attributeN TypeN);</code></pre>

<p><strong>Example</strong></p>
<p>The following defines a RDBMS data store pointing to a MySQL database with name <code>hotel</code> hosted in <code>loacalhost:3306</code> 
having a table <code>RoomTypeTable</code> with columns <code>roomNo</code> of <code>INTEGER</code> and <code>type</code> of <code>VARCHAR(255)</code> mapped to Siddhi data types <code>int</code> and <code>string</code> respectively.</p>
<pre class="codehilite"><code class="language-sql linenums">@Store(type="rdbms", jdbc.url="jdbc:mysql://localhost:3306/hotel", username="siddhi", password="123", 
       jdbc.driver.name="com.mysql.jdbc.Driver")
define table RoomTypeTable ( roomNo int, type string );</code></pre>

<p><strong>Supported Store Types</strong></p>
<p>The following is a list of currently supported store types:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-rdbms">RDBMS (MySQL, Oracle, SQL Server, PostgreSQL, DB2, H2)</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-solr">Solr</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-mongodb">MongoDB</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-hbase">HBase</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-redis">Redis</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-store-cassandra">Cassandra</a></li>
</ul>
<p><strong>Operators on Table (and Store)</strong></p>
<p>The following operators can be performed on tables (and stores).</p>
<h3 id="insert">Insert<a class="headerlink" href="#insert" title="Permanent link">&para;</a></h3>
<p>This allows events to be inserted into tables. This is similar to inserting events into streams. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the table is defined with primary keys, and if you insert duplicate data, primary key constrain violations can occur. 
In such cases use the <code>update or insert into</code> operation. </p>
</div>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;table&gt;</code></pre>

<p>Similar to streams, you need to use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords in order to insert only the specific output event types. 
For more information, see <a href="#output-event-types">output event type</a></p>
<p><strong>Example</strong></p>
<p>This query inserts all the events from the <code>TempStream</code> stream to the <code>TempTable</code> table.</p>
<pre class="codehilite"><code class="language-sql linenums">from TempStream
select *
insert into TempTable;</code></pre>

<h3 id="join-table">Join (Table)<a class="headerlink" href="#join-table" title="Permanent link">&para;</a></h3>
<p>This allows a stream to retrieve information from a table in a streaming manner.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Joins can also be performed with <a href="#join-stream">two streams</a>, <a href="#join-aggregation">aggregation</a> or against externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; join &lt;table&gt;
    on &lt;condition&gt;
select (&lt;input stream&gt;|&lt;table&gt;).&lt;attribute name&gt;, (&lt;input stream&gt;|&lt;table&gt;).&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A table can only be joint with a stream. Two tables cannot be joint because there must be at least one active 
entity to trigger the join operation.</p>
</div>
<p><strong>Example</strong></p>
<p>This Siddhi App performs a join to retrieve the room type from <code>RoomTypeTable</code> table based on the room number, so that it can filter the events related to <code>server-room</code>s.</p>
<pre class="codehilite"><code class="language-sql linenums">define table RoomTypeTable (roomNo int, type string);
define stream TempStream (deviceID long, roomNo int, temp double);

from TempStream join RoomTypeTable
    on RoomTypeTable.roomNo == TempStream.roomNo
select deviceID, RoomTypeTable.type as roomType, type, temp
    having roomType == 'server-room'
insert into ServerRoomTempStream;</code></pre>

<p><strong>Supported join types</strong> </p>
<p>Table join supports following join operations.</p>
<ul>
<li>
<p><strong>Inner join (join)</strong> </p>
<p>This is the default behaviour of a join operation. <code>join</code> is used as the keyword to join the stream with the table. The output is generated only if there is a matching event in both the stream and the table.</p>
</li>
<li>
<p><strong>Left outer join</strong> </p>
<p>The <code>left outer join</code> operation allows you to join a stream on left side with a table on the right side based on a condition.
Here, it returns all the events of left stream even if there are no matching events in the right table by 
having null values for the attributes of the right table.</p>
</li>
<li>
<p><strong>Right outer join</strong> </p>
<p>This is similar to a <code>left outer join</code>. <code>right outer join</code> is used as the keyword to join a stream on right side with a table on the left side based on a condition.
It returns all the events of the right stream even if there are no matching events in the left table. </p>
</li>
</ul>
<h3 id="delete">Delete<a class="headerlink" href="#delete" title="Permanent link">&para;</a></h3>
<p>To delete selected events that are stored in a table.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
delete &lt;table&gt; (for &lt;output event type&gt;)?
    on &lt;condition&gt;</code></pre>

<p>The <code>condition</code> element specifies the basis on which events are selected to be deleted. 
When specifying the condition, table attributes should be referred to with the table name.</p>
<p>To execute delete for specific output event types, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. For more information, see <a href="#output-event-types">output event type</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes must be always referred to with the table name as follows: 
<code>&lt;table name&gt;.&lt;attibute name&gt;</code></p>
</div>
<p><strong>Example</strong></p>
<p>In this example, the script deletes a record in the <code>RoomTypeTable</code> table if it has a value for the <code>roomNo</code> attribute that matches the value for the <code>roomNumber</code> attribute of an event in the <code>DeleteStream</code> stream.</p>
<pre class="codehilite"><code class="language-sql linenums">define table RoomTypeTable (roomNo int, type string);

define stream DeleteStream (roomNumber int);

from DeleteStream
delete RoomTypeTable
    on RoomTypeTable.roomNo == roomNumber;</code></pre>

<h3 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h3>
<p>This operator updates selected event attributes stored in a table based on a condition. </p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
update &lt;table&gt; (for &lt;output event type&gt;)? 
    set &lt;table&gt;.&lt;attribute name&gt; = (&lt;attribute name&gt;|&lt;expression&gt;)?, &lt;table&gt;.&lt;attribute name&gt; = (&lt;attribute name&gt;|&lt;expression&gt;)?, ...
    on &lt;condition&gt;</code></pre>

<p>The <code>condition</code> element specifies the basis on which events are selected to be updated.
When specifying the <code>condition</code>, table attributes must be referred to with the table name.</p>
<p>You can use the <code>set</code> keyword to update selected attributes from the table. Here, for each assignment, the attribute specified in the left must be the table attribute, and the one specified in the right can be a stream/table attribute a mathematical operation, or other. When the <code>set</code> clause is not provided, all the attributes in the table are updated.</p>
<p>To execute an update for specific output event types use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. For more information, see <a href="#output-event-types">output event type</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes must be always referred to with the table name as shown below:
 <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>This Siddhi application updates the room occupancy in the <code>RoomOccupancyTable</code> table for each room number based on new arrivals and exits from the <code>UpdateStream</code> stream.</p>
<pre class="codehilite"><code class="language-sql linenums">define table RoomOccupancyTable (roomNo int, people int);
define stream UpdateStream (roomNumber int, arrival int, exit int);

from UpdateStream
select *
update RoomOccupancyTable
    set RoomOccupancyTable.people = RoomOccupancyTable.people + arrival - exit
    on RoomOccupancyTable.roomNo == roomNumber;</code></pre>

<h3 id="update-or-insert">Update or Insert<a class="headerlink" href="#update-or-insert" title="Permanent link">&para;</a></h3>
<p>This allows you update if the event attributes already exist in the table based on a condition, or 
else insert the entry as a new attribute.</p>
<p><strong>Syntax</strong></p>
<p><pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
update or insert into &lt;table&gt; (for &lt;output event type&gt;)? 
    set &lt;table&gt;.&lt;attribute name&gt; = &lt;expression&gt;, &lt;table&gt;.&lt;attribute name&gt; = &lt;expression&gt;, ...
    on &lt;condition&gt;</code></pre>
The <code>condition</code> element specifies the basis on which events are selected for update.
When specifying the <code>condition</code>, table attributes should be referred to with the table name. 
If a record that matches the condition does not already exist in the table, the arriving event is inserted into the table.</p>
<p>The <code>set</code> clause is only used when an update is performed during the insert/update operation. 
When <code>set</code> clause is used, the attribute to the left is always a table attribute, and the attribute to the right can be a stream/table attribute, mathematical 
operation or other. The attribute to the left (i.e., the attribute in the event table) is updated with the value of the attribute to the right if the given condition is met. When the <code>set</code> clause is not provided, all the attributes in the table are updated. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the attribute to the right is a table attribute, the operations supported differ based on the database type.</p>
</div>
<p>To execute update upon specific output event types use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. To understand more see <a href="#output-event-types">output event type</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes should be always referred to with the table name as <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>The following query update for events in the <code>UpdateTable</code> event table that have room numbers that match the same in the <code>UpdateStream</code> stream. When such events are found in the event table, they are updated. When a room number available in the stream is not found in the event table, it is inserted from the stream.</p>
<pre class="codehilite"><code class="language-sql linenums">define table RoomAssigneeTable (roomNo int, type string, assignee string);
define stream RoomAssigneeStream (roomNumber int, type string, assignee string);

from RoomAssigneeStream
select roomNumber as roomNo, type, assignee
update or insert into RoomAssigneeTable
    set RoomAssigneeTable.assignee = assignee
    on RoomAssigneeTable.roomNo == roomNo;</code></pre>

<h3 id="in">In<a class="headerlink" href="#in" title="Permanent link">&para;</a></h3>
<p>This allows the stream to check whether the expected value exists in the table as a part of a conditional operation.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt;[&lt;condition&gt; in &lt;table&gt;]
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p>The <code>condition</code> element specifies the basis on which events are selected to be compared. 
When constructing the <code>condition</code>, the table attribute must be always referred to with the table name as shown below:
<code>&lt;table&gt;.&lt;attibute name&gt;</code>.</p>
<p><strong>Example</strong></p>
<p>This Siddhi application filters only room numbers that are listed in the <code>ServerRoomTable</code> table.</p>
<pre class="codehilite"><code class="language-sql linenums">define table ServerRoomTable (roomNo int);
define stream TempStream (deviceID long, roomNo int, temp double);

from TempStream[ServerRoomTable.roomNo == roomNo in ServerRoomTable]
insert into ServerRoomTempStream;</code></pre>

<h2 id="incremental-aggregation">Incremental Aggregation<a class="headerlink" href="#incremental-aggregation" title="Permanent link">&para;</a></h2>
<p>Incremental aggregation allows you to obtain aggregates in an incremental manner for a specified set of time periods.</p>
<p>This not only allows you to calculate aggregations with varied time granularity, but also allows you to access them in an interactive
 manner for reports, dashboards, and for further processing. Its schema is defined via the <strong>aggregation definition</strong>.</p>
<p>Incremental aggregation granularity data holders are automatically purged every 15 minutes. When carrying out data purging, the retention period you have specified for each granularity in the incremental aggregation query is taken into account. The retention period defined for a granularity needs to be greater than or equal to its minimum retention period as specified in the table below. If no valid retention period is defined for a granularity, the default retention period (as specified in the table below) is applied. </p>
<table>
<thead>
<tr>
<th>Granularity</th>
<th>Default retention</th>
<th>Minimum retention</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>second</code></td>
<td><code>120</code> seconds</td>
<td><code>120</code> seconds</td>
</tr>
<tr>
<td><code>minute</code></td>
<td><code>24</code>  hours</td>
<td><code>120</code> minutes</td>
</tr>
<tr>
<td><code>hour</code></td>
<td><code>30</code>  days</td>
<td><code>25</code>  hours</td>
</tr>
<tr>
<td><code>day</code></td>
<td><code>1</code>   year</td>
<td><code>32</code>  days</td>
</tr>
<tr>
<td><code>month</code></td>
<td><code>All</code></td>
<td><code>13</code>  month</td>
</tr>
<tr>
<td><code>year</code></td>
<td><code>All</code></td>
<td><code>none</code></td>
</tr>
</tbody>
</table>
<p><strong>Purpose</strong></p>
<p>Incremental aggregation allows you to retrieve the aggregate values for different time durations. 
That is, it allows you to obtain aggregates such as <code>sum</code>, <code>count</code>, <code>avg</code>, <code>min</code>, <code>max</code>, <code>count</code> and <code>distinctCount</code>
of stream attributes for durations such as <code>sec</code>, <code>min</code>, <code>hour</code>, etc.</p>
<p>This is of considerable importance in many Analytics scenarios because aggregate values are often needed for several time periods. 
Furthermore, this ensures that the aggregations are not lost due to unexpected system failures because aggregates can be stored in different persistence <code>stores</code>.</p>
<p><strong>Syntax</strong></p>
<p><pre class="codehilite"><code class="language-sql linenums">@store(type="&lt;store type&gt;", ...)
@purge(enable="&lt;true or false&gt;",interval=&lt;purging interval&gt;,@retentionPeriod(&lt;granularity&gt; = &lt;retention period&gt;, ...) )
define aggregation &lt;aggregator name&gt;
from &lt;input stream&gt;
select &lt;attribute name&gt;, &lt;aggregate function&gt;(&lt;attribute name&gt;) as &lt;attribute name&gt;, ...
    group by &lt;attribute name&gt;
    aggregate by &lt;timestamp attribute&gt; every &lt;time periods&gt; ;</code></pre>
The above syntax includes the following:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@BufferSize</code></td>
<td><strong>DEPRECIATED FROM V4.2.0</strong>. This identifies the number of expired events to retain in a buffer in order<br/>to handle out of order event processing. This is an optional<br/>parameter that is applicable only if aggregation is based on external<br/>timestamps (because events aggregated based on event arrival<br/>time cannot be out of order). Siddhi determines whether an event is expired or not<br/>based on the timestamp of the latest event and the most granular duration for<br/>which aggregation is calculated.<br/> e.g., If the aggregation is calculated for <code>sec…year</code>, the most granular duration is seconds. Therefore, if the buffer size is <code>3</code> and events arrive during 51<sup>st</sup>, 52<sup>nd</sup>, 53<sup>rd</sup> and 54<sup>th</sup> seconds, all of the older aggregations (i.e., for 51<sup>st</sup>, 52<sup>nd</sup> and 53<sup>rd</sup> seconds) are kept in the buffer because the latest event arrived during the 54<sup>th</sup> second. <br/>The default value is <code>0</code>.</td>
</tr>
<tr>
<td><code>@IgnoreEventsOlderThanBuffer</code></td>
<td><strong>DEPRECIATED FROM V4.2.0</strong>.This annotation specifies whether or not to aggregate events older than the <br/>buffer. If this parameter is set to <code>false</code> (which is default), any event <br/>older than the buffer is aggregated with the oldest event in buffer. If <br/>this parameter is set to <code>true</code>, any event older than the buffer is dropped. This is an optional annotation.</td>
</tr>
<tr>
<td><code>@store</code></td>
<td>This annotation is used to refer to the data store where the calculated <br/>aggregate results are stored. This annotation is optional. When <br/>no annotation is provided, the data is stored in the <code>in-memory</code> store.</td>
</tr>
<tr>
<td><code>@purge</code></td>
<td>This annotation is used to configure purging in aggregation granularities.<br/> If this annotation is not provided, the default purging mentioned above is applied.<br/> If you want to disable automatic data purging, you can use this annotation as follows:</br>'@purge(enable=false)</br>/You should disable data purging if the aggregation query in included in the Siddhi application for read-only purposes.</td>
</tr>
<tr>
<td><code>@retentionPeriod</code></td>
<td>This annotation is used to specify the length of time the data needs to be retained when carrying out data purging.<br/> If this annotation is not provided, the default retention period is applied.</td>
</tr>
<tr>
<td><code>&lt;aggregator name&gt;</code></td>
<td>This specifies a unique name for the aggregation so that it can be referred <br/>when accessing aggregate results.</td>
</tr>
<tr>
<td><code>&lt;input stream&gt;</code></td>
<td>The stream that feeds the aggregation. <strong>Note! this stream should be <br/>already defined.</strong></td>
</tr>
<tr>
<td><code>group by &lt;attribute name&gt;</code></td>
<td>The <code>group by</code> clause is optional. If it is included in a Siddhi application, aggregate values <br/> are calculated per each <code>group by</code> attribute. If it is not used, all the<br/> events are aggregated together.</td>
</tr>
<tr>
<td><code>by &lt;timestamp attribute&gt;</code></td>
<td>This clause is optional. This defines the attribute that should be used as<br/> the timestamp. If this clause is not used, the event time is used by default.<br/> The timestamp could be given as either a <code>string</code> or a <code>long</code> value. If it is a <code>long</code> value,<br/> the unix timestamp in milliseconds is expected (e.g. <code>1496289950000</code>). If it is <br/>a <code>string</code> value, the supported formats are <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt; &lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt;</code> <br/>(if time is in GMT) and  <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt; &lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt; &lt;Z&gt;</code> (if time is <br/>not in GMT), here the ISO 8601 UTC offset must be provided for <code>&lt;Z&gt;</code> .<br/>(e.g., <code>+05:30</code>, <code>-11:00</code>).</td>
</tr>
<tr>
<td><code>&lt;time periods&gt;</code></td>
<td>Time periods can be specified as a range where the minimum and the maximum value are separated by three dots, or as comma-separated values. <br><br> e.g., A range can be specified as sec...year where aggregation is done per second, minute, hour, day, month and year. Comma-separated values can be specified as min, hour. <br><br> Skipping time durations (e.g., min, day where the hour duration is skipped) when specifying comma-separated values is supported only from v4.1.1 onwards</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From V4.2.0 onwards, aggregation is carried out at calendar start times for each granularity with the GMT timezone</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From V4.2.6 onwards, the same aggregation can be defined in multiple Siddhi apps for joining, however, <em>only one siddhi app should carry out the processing</em> (i.e. the aggregation input stream should only feed events to one aggregation definition). </p>
</div>
<p><strong>Example</strong></p>
<p>This Siddhi Application defines an aggregation named <code>TradeAggregation</code> to calculate the average and sum for the <code>price</code> attribute of events arriving at the <code>TradeStream</code> stream. These aggregates are calculated per every time granularity in the second-year range.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream TradeStream (symbol string, price double, volume long, timestamp long);

@purge(enable='true', interval='10 sec',@retentionPeriod(sec='120 sec',min='24 hours',hours='30 days',days='1 year',months='all',years='all'))
define aggregation TradeAggregation
  from TradeStream
  select symbol, avg(price) as avgPrice, sum(price) as total
    group by symbol
    aggregate by timestamp every sec ... year;</code></pre>

<h3 id="distributed-aggregation">Distributed Aggregation<a class="headerlink" href="#distributed-aggregation" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Distributed Aggregation is only supported after v4.3.0</p>
</div>
<p>Distributed Aggregation allows you to partially process aggregations in different shards. This allows Siddhi
app in one shard to be responsible only for processing a part of the aggregation.
However for this, all aggregations must be based on a common physical database(@store).</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">@store(type="&lt;store type&gt;", ...)
@PartitionById
define aggregation &lt;aggregator name&gt;
from &lt;input stream&gt;
select &lt;attribute name&gt;, &lt;aggregate function&gt;(&lt;attribute name&gt;) as &lt;attribute name&gt;, ...
    group by &lt;attribute name&gt;
    aggregate by &lt;timestamp attribute&gt; every &lt;time periods&gt; ;</code></pre>

<p>Following table includes the <code>annotation</code> to be used to enable distributed aggregation, </p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@PartitionById</code></td>
<td>If the annotation is given, then the distributed aggregation is enabled. Further this can be disabled by using <code>enable</code> element, </br><code>@PartitionById(enable='false')</code>.</br></td>
</tr>
</tbody>
</table>
<p>Further, following system properties are also available,</p>
<table>
<thead>
<tr>
<th>System Property</th>
<th>Description</th>
<th>Possible Values</th>
<th>Optional</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>shardId</td>
<td>The id of the shard one of the distributed aggregation is running in. This should be unique to a single shard</td>
<td>Any string</td>
<td>No</td>
<td><Empty_String></td>
</tr>
<tr>
<td>partitionById</td>
<td>This allows user to enable/disable distributed aggregation for all aggregations running in one siddhi manager .(Available from v4.3.3)</td>
<td>true/false</td>
<td>Yesio</td>
<td>false</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ShardIds should not be changed after the first configuration in order to keep data consistency.</p>
</div>
<h3 id="join-aggregation">Join (Aggregation)<a class="headerlink" href="#join-aggregation" title="Permanent link">&para;</a></h3>
<p>This allows a stream to retrieve calculated aggregate values from the aggregation. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A join can also be performed with <a href="#join-stream">two streams</a>, with a <a href="#join-table">table</a> and a stream, or with a stream against externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<p>A join with aggregation is similer to the join with <a href="#join-table">table</a>, but with additional <code>within</code> and <code>per</code> clauses. </p>
<p><pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; join &lt;aggrigation&gt; 
  on &lt;join condition&gt; 
  within &lt;time range&gt; 
  per &lt;time granularity&gt;
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream&gt;;</code></pre>
Apart from constructs of <a href="#join-table">table join</a> this includes the following. Please note that the 'on' condition is optional :</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>within  &lt;time range&gt;</code></td>
<td>This allows you to specify the time interval for which the aggregate values need to be retrieved. This can be specified by providing the start and end time separated by a comma as <code>string</code> or <code>long</code> values, or by using the wildcard <code>string</code> specifying the data range. For details refer examples.</td>
</tr>
<tr>
<td><code>per &lt;time granularity&gt;</code></td>
<td>This specifies the time granularity by which the aggregate values must be grouped and returned. e.g., If you specify <code>days</code>, the retrieved aggregate values are grouped for each day within the selected time interval.</td>
</tr>
<tr>
<td><code>AGG_TIMESTAMP</code></td>
<td>This specifies the start time of the aggregations and can be used in the select clause.</td>
</tr>
</tbody>
</table>
<p><code>within</code> and <code>per</code> clauses also accept attribute values from the stream.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The timestamp of the aggregations can be accessed through the <code>AGG_TIMESTAMP</code> attribute.</p>
</div>
<p><strong>Example</strong></p>
<p>Following aggregation definition will be used for the examples. </p>
<pre class="codehilite"><code class="language-sql linenums">define stream TradeStream (symbol string, price double, volume long, timestamp long);

define aggregation TradeAggregation
  from TradeStream
  select AGG_TIMESTAMP, symbol, avg(price) as avgPrice, sum(price) as total
    group by symbol
    aggregate by timestamp every sec ... year;</code></pre>

<p>This query retrieves daily aggregations within the time range <code>"2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30"</code> (Please note that +05:30 can be omitted if timezone is GMT)</p>
<pre class="codehilite"><code class="language-sql linenums">define stream StockStream (symbol string, value int);

from StockStream as S join TradeAggregation as T
  on S.symbol == T.symbol 
  within "2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30" 
  per "days" 
select S.symbol, T.total, T.avgPrice 
insert into AggregateStockStream;</code></pre>

<p>This query retrieves hourly aggregations within the day <code>2014-02-15</code>.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream StockStream (symbol string, value int);

from StockStream as S join TradeAggregation as T
  on S.symbol == T.symbol 
  within "2014-02-15 **:**:** +05:30"
  per "hours" 
select S.symbol, T.total, T.avgPrice 
insert into AggregateStockStream;</code></pre>

<p>This query retrieves all aggregations per <code>perValue</code> stream attribute within the time period 
between timestamps <code>1496200000000</code> and <code>1596434876000</code>.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream StockStream (symbol string, value int, perValue string);

from StockStream as S join TradeAggregation as T
  on S.symbol == T.symbol 
  within 1496200000000L, 1596434876000L
  per S.perValue
select S.symbol, T.total, T.avgPrice 
insert into AggregateStockStream;</code></pre>

<p><strong>Supported join types</strong> </p>
<p>Aggregation join supports following join operations.</p>
<ul>
<li>
<p><strong>Inner join (join)</strong> </p>
<p>This is the default behaviour of a join operation. <code>join</code> is used as the keyword to join the stream with the aggregation. The output is generated only if there is a matching event in the stream and the aggregation.</p>
</li>
<li>
<p><strong>Left outer join</strong> </p>
<p>The <code>left outer join</code> operation allows you to join a stream on left side with a aggregation on the right side based on a condition.
Here, it returns all the events of left stream even if there are no matching events in the right aggregation by 
having null values for the attributes of the right aggregation.</p>
</li>
<li>
<p><strong>Right outer join</strong> </p>
<p>This is similar to a <code>left outer join</code>. <code>right outer join</code> is used as the keyword to join a stream on right side with a aggregation on the left side based on a condition.
It returns all the events of the right stream even if there are no matching events in the left aggregation. </p>
</li>
</ul>
<h2 id="defined-window"><em>(Defined)</em> Window<a class="headerlink" href="#defined-window" title="Permanent link">&para;</a></h2>
<p>A defined window is a window that can be shared across multiple queries. 
Events can be inserted to a defined window from one or more queries and it can produce output events based on the defined window type.</p>
<p><strong>Syntax</strong></p>
<p>The syntax for a defined window is as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">define window &lt;window name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... ) &lt;window type&gt;(&lt;parameter&gt;, &lt;parameter&gt;, …) &lt;output event type&gt;;</code></pre>

<p>The following parameters are configured in a table definition:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>window name</code></td>
<td>The name of the window defined. (<code>PascalCase</code> is used for window names as a convention.)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of the window is defined by its attributes with uniquely identifiable attribute names (<code>camelCase</code> is used for attribute names as a convention.)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
<tr>
<td><code>&lt;window type&gt;(&lt;parameter&gt;, ...)</code></td>
<td>The window type associated with the window and its parameters.</td>
</tr>
<tr>
<td><code>output &lt;output event type&gt;</code></td>
<td>This is optional. Keywords such as <code>current events</code>, <code>expired events</code> and <code>all events</code> (the default) can be used to specify when the window output should be exposed. For more information, see <a href="#output-event-types">output event type</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Returning all output when events arrive and when events expire from the window.</p>
<p>In this query, the output event type is not specified. Therefore, it returns both current and expired events as the output.</p>
</li>
</ul>
<p><pre class="codehilite"><code class="language-sql linenums">  define window SensorWindow (name string, value float, roomNo int, deviceID string) timeBatch(1 second);</code></pre>
+ Returning an output only when events expire from the window.</p>
<pre class="codehilite"><code class="linenums">In this query, the output event type of the window is `expired events`. Therefore, it only returns the events that have expired from the window as the output.</code></pre>


<pre class="codehilite"><code class="language-sql linenums">  define window SensorWindow (name string, value float, roomNo int, deviceID string) timeBatch(1 second) output expired events;</code></pre>

<p><strong>Operators on Defined Windows</strong></p>
<p>The following operators can be performed on defined windows.</p>
<h3 id="insert_1">Insert<a class="headerlink" href="#insert_1" title="Permanent link">&para;</a></h3>
<p>This allows events to be inserted into windows. This is similar to inserting events into streams. </p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;window&gt;</code></pre>

<p>To insert only events of a specific output event type, add the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords (similar to how it is done for streams).</p>
<p>For more information, see <a href="#output-event-types">output event type</a>.</p>
<p><strong>Example</strong></p>
<p>This query inserts all events from the <code>TempStream</code> stream to the <code>OneMinTempWindow</code> window.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream TempStream(tempId string, temp double);
define window OneMinTempWindow(tempId string, temp double) time(1 min);

from TempStream
select *
insert into OneMinTempWindow;</code></pre>

<h3 id="join-window">Join (Window)<a class="headerlink" href="#join-window" title="Permanent link">&para;</a></h3>
<p>To allow a stream to retrieve information from a window based on a condition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A join can also be performed with <a href="#join-stream">two streams</a>, <a href="#join-aggregation">aggregation</a> or with tables <a href="#join-table">tables</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;input stream&gt; join &lt;window&gt;
    on &lt;condition&gt;
select (&lt;input stream&gt;|&lt;window&gt;).&lt;attribute name&gt;, (&lt;input stream&gt;|&lt;window&gt;).&lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p><strong>Example</strong></p>
<p>This Siddhi Application performs a join count the number of temperature events having more then 40 degrees 
 within the last 2 minutes. </p>
<pre class="codehilite"><code class="language-sql linenums">define window TwoMinTempWindow (roomNo int, temp double) time(2 min);
define stream CheckStream (requestId string);

from CheckStream as C join TwoMinTempWindow as T
    on T.temp &gt; 40
select requestId, count(T.temp) as count
insert into HighTempCountStream;</code></pre>

<p><strong>Supported join types</strong> </p>
<p>Window join supports following operations of a join clause.</p>
<ul>
<li>
<p><strong>Inner join (join)</strong> </p>
<p>This is the default behaviour of a join operation. <code>join</code> is used as the keyword to join two windows or a stream with a window. The output is generated only if there is a matching event in both stream/window.</p>
</li>
<li>
<p><strong>Left outer join</strong> </p>
<p>The <code>left outer join</code> operation allows you to join two windows or a stream with a window to be merged based on a condition. 
Here, it returns all the events of left stream/window even if there are no matching events in the right stream/window by 
having null values for the attributes of the right stream/window.</p>
</li>
<li>
<p><strong>Right outer join</strong> </p>
<p>This is similar to a left outer join. <code>Right outer join</code> is used as the keyword to join two windows or a stream with a window.
It returns all the events of the right stream/window even if there are no matching events in the left stream/window. </p>
</li>
<li>
<p><strong>Full outer join</strong> </p>
<p>The full outer join combines the results of <code>left outer join</code> and <code>right outer join</code>. <code>full outer join</code> is used as the keyword to join two windows or a stream with a window.
Here, output event are generated for each incoming event even if there are no matching events in the other stream/window.</p>
</li>
</ul>
<h3 id="from">From<a class="headerlink" href="#from" title="Permanent link">&para;</a></h3>
<p>A window can be an input to a query, similar to streams. </p>
<p>Note !!!
     When window is used as an input to a query, another window cannot be applied on top of this.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;window&gt; 
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;output stream&gt;</code></pre>

<p><strong>Example</strong>
This Siddhi Application calculates the maximum temperature within the last 5 minutes.</p>
<pre class="codehilite"><code class="language-sql linenums">define window FiveMinTempWindow (roomNo int, temp double) time(5 min);

from FiveMinTempWindow
select max(temp) as maxValue, roomNo
insert into MaxSensorReadingStream;</code></pre>

<h2 id="trigger">Trigger<a class="headerlink" href="#trigger" title="Permanent link">&para;</a></h2>
<p>Triggers allow events to be periodically generated. <strong>Trigger definition</strong> can be used to define a trigger. 
A trigger also works like a stream with a predefined schema.</p>
<p><strong>Purpose</strong></p>
<p>For some use cases the system should be able to periodically generate events based on a specified time interval to perform 
some periodic executions. </p>
<p>A trigger can be performed for a <code>'start'</code> operation, for a given <code>&lt;time interval&gt;</code>, or for a given <code>'&lt;cron expression&gt;'</code>.</p>
<p><strong>Syntax</strong></p>
<p>The syntax for a trigger definition is as follows.</p>
<pre class="codehilite"><code class="language-sql linenums">define trigger &lt;trigger name&gt; at ('start'| every &lt;time interval&gt;| '&lt;cron expression&gt;');</code></pre>

<p>Similar to streams, triggers can be used as inputs. They adhere to the following stream definition and produce the <code>triggered_time</code> attribute of the <code>long</code> type.</p>
<pre class="codehilite"><code class="language-sql linenums">define stream &lt;trigger name&gt; (triggered_time long);</code></pre>

<p>The following types of triggeres are currently supported:</p>
<table>
<thead>
<tr>
<th>Trigger type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'start'</code></td>
<td>An event is triggered when Siddhi is started.</td>
</tr>
<tr>
<td><code>every &lt;time interval&gt;</code></td>
<td>An event is triggered periodically at the given time interval.</td>
</tr>
<tr>
<td><code>'&lt;cron expression&gt;'</code></td>
<td>An event is triggered periodically based on the given cron expression. For configuration details, see <a target="_blank" href="http://www.quartz-scheduler.org/documentation/quartz-2.1.7/tutorials/tutorial-lesson-06.html">quartz-scheduler</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Triggering events regularly at specific time intervals</p>
<p>The following query triggers events every 5 minutes.</p>
</li>
</ul>
<pre class="codehilite"><code class="language-sql linenums">     define trigger FiveMinTriggerStream at every 5 min;</code></pre>

<ul>
<li>
<p>Triggering events at a specific time on specified days</p>
<p>The following query triggers an event at 10.15 AM on every weekdays.</p>
</li>
</ul>
<pre class="codehilite"><code class="language-sql linenums">     define trigger FiveMinTriggerStream at '0 15 10 ? * MON-FRI';</code></pre>

<h2 id="script">Script<a class="headerlink" href="#script" title="Permanent link">&para;</a></h2>
<p>Scripts allow you to write functions in other programming languages and execute them within Siddhi queries. 
Functions defined via scripts can be accessed in queries similar to any other inbuilt function. 
<strong>Function definitions</strong> can be used to define these scripts.</p>
<p>Function parameters are passed into the function logic as <code>Object[]</code> and with the name <code>data</code> . </p>
<p><strong>Purpose</strong></p>
<p>Scripts allow you to define a function operation that is not provided in Siddhi core or its extension. It is not required to write an extension to define the function logic.</p>
<p><strong>Syntax</strong></p>
<p>The syntax for a Script definition is as follows.</p>
<pre class="codehilite"><code class="language-sql linenums">define function &lt;function name&gt;[&lt;language name&gt;] return &lt;return type&gt; {
    &lt;operation of the function&gt;
};</code></pre>

<p>The following parameters are configured when defining a script.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function name</code></td>
<td>The name of the function (<code>camelCase</code> is used for the function name) as a convention.</td>
</tr>
<tr>
<td><code>language name</code></td>
<td>The name of the programming language used to define the script, such as <code>javascript</code>, <code>r</code> and <code>scala</code>.</td>
</tr>
<tr>
<td><code>return type</code></td>
<td>The attribute type of the function’s return. This can be <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>bool</code> or <code>object</code>. Here the function implementer should be responsible for returning the output attribute on the defined return type for proper functionality.</td>
</tr>
<tr>
<td><code>operation of the function</code></td>
<td>Here, the execution logic of the function is added. This logic should be written in the language specified under the <code>language name</code>, and it should return the output in the data type specified via the <code>return type</code> parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<p>This query performs concatenation using JavaScript, and returns the output as a string.</p>
<pre class="codehilite"><code class="language-sql linenums">define function concatFn[javascript] return string {
    var str1 = data[0];
    var str2 = data[1];
    var str3 = data[2];
    var responce = str1 + str2 + str3;
    return responce;
};

define stream TempStream(deviceID long, roomNo int, temp double);

from TempStream
select concatFn(roomNo,'-',deviceID) as id, temp 
insert into DeviceTempStream;</code></pre>

<h2 id="store-query">Store Query<a class="headerlink" href="#store-query" title="Permanent link">&para;</a></h2>
<p>Siddhi store queries are a set of on-demand queries that can be used to perform operations on Siddhi tables, windows, and aggregators.</p>
<p><strong>Purpose</strong></p>
<p>Store queries allow you to execute the following operations on Siddhi tables, windows, and aggregators without the intervention of streams.</p>
<p>Queries supported for tables:</p>
<ul>
<li>SELECT</li>
<li>INSERT</li>
<li>DELETE</li>
<li>UPDATE</li>
<li>UPDATE OR INSERT</li>
</ul>
<p>Queries supported for windows and aggregators:</p>
<ul>
<li>SELECT</li>
</ul>
<p>This is be done by submitting the store query to the Siddhi application runtime using its <code>query()</code> method.</p>
<p>In order to execute store queries, the Siddhi application of the Siddhi application runtime you are using, should have
 a store defined, which contains the table that needs to be queried.</p>
<p><strong>Example</strong></p>
<p>If you need to query the table named <code>RoomTypeTable</code> the it should have been defined in the Siddhi application.</p>
<p>In order to execute a store query on <code>RoomTypeTable</code>, you need to submit the store query using <code>query()</code> 
method of <code>SiddhiAppRuntime</code> instance as below.</p>
<pre class="codehilite"><code class="language-java linenums">siddhiAppRuntime.query(&lt;store query&gt;);</code></pre>

<h3 id="tablewindow-select"><em>(Table/Window)</em> Select<a class="headerlink" href="#tablewindow-select" title="Permanent link">&para;</a></h3>
<p>The <code>SELECT</code> store query retrieves records from the specified table or window, based on the given condition.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;table/window&gt;
&lt;on condition&gt;?
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
&lt;group by&gt;? 
&lt;having&gt;? 
&lt;order by&gt;? 
&lt;limit&gt;?</code></pre>

<p><strong>Example</strong></p>
<p>This query retrieves room numbers and types of the rooms starting from room no 10.</p>
<pre class="codehilite"><code class="language-sql linenums">from roomTypeTable
on roomNo &gt;= 10;
select roomNo, type</code></pre>

<h3 id="aggregation-select"><em>(Aggregation)</em> Select<a class="headerlink" href="#aggregation-select" title="Permanent link">&para;</a></h3>
<p>The <code>SELECT</code> store query retrieves records from the specified aggregation, based on the given condition, time range, 
and granularity.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">from &lt;aggregation&gt;
&lt;on condition&gt;?
within &lt;time range&gt;
per &lt;time granularity&gt;
select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
&lt;group by&gt;? 
&lt;having&gt;? 
&lt;order by&gt;? 
&lt;limit&gt;?</code></pre>

<p><strong>Example</strong></p>
<p>Following aggregation definition will be used for the examples. </p>
<pre class="codehilite"><code class="language-sql linenums">define stream TradeStream (symbol string, price double, volume long, timestamp long);

define aggregation TradeAggregation
  from TradeStream
  select symbol, avg(price) as avgPrice, sum(price) as total
    group by symbol
    aggregate by timestamp every sec ... year;</code></pre>

<p>This query retrieves daily aggregations within the time range <code>"2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30"</code> (Please note that +05:30 can be omitted if timezone is GMT)</p>
<pre class="codehilite"><code class="language-sql linenums">from TradeAggregation
  within "2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30" 
  per "days" 
select symbol, total, avgPrice ;</code></pre>

<p>This query retrieves hourly aggregations of "FB" symbol within the day <code>2014-02-15</code>.</p>
<pre class="codehilite"><code class="language-sql linenums">from TradeAggregation
  on symbol == "FB" 
  within "2014-02-15 **:**:** +05:30"
  per "hours" 
select symbol, total, avgPrice;</code></pre>

<h3 id="insert_2">Insert<a class="headerlink" href="#insert_2" title="Permanent link">&para;</a></h3>
<p>This allows you to insert a new record to the table with the attribute values you define in the <code>select</code> section.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
insert into &lt;table&gt;;</code></pre>

<p><strong>Example</strong></p>
<p>This store query inserts a new record to the table <code>RoomOccupancyTable</code>, with the specified attribute values.</p>
<pre class="codehilite"><code class="language-sql linenums">select 10 as roomNo, 2 as people
insert into RoomOccupancyTable </code></pre>

<h3 id="delete_1">Delete<a class="headerlink" href="#delete_1" title="Permanent link">&para;</a></h3>
<p>The <code>DELETE</code> store query deletes selected records from a specified table.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">&lt;select&gt;?  
delete &lt;table&gt;  
on &lt;conditional expresssion&gt;</code></pre>

<p>The <code>condition</code> element specifies the basis on which records are selected to be deleted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes must always be referred to with the table name as shown below: <br />
 <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>In this example, query deletes a record in the table named <code>RoomTypeTable</code> if it has value for the <code>roomNo</code> 
attribute that matches the value for the <code>roomNumber</code> attribute of the selection which has 10 as the actual value.</p>
<pre class="codehilite"><code class="language-sql linenums">select 10 as roomNumber
delete RoomTypeTable
on RoomTypeTable.roomNo == roomNumber;</code></pre>

<pre class="codehilite"><code class="language-sql linenums">delete RoomTypeTable
on RoomTypeTable.roomNo == 10;</code></pre>

<h3 id="update_1">Update<a class="headerlink" href="#update_1" title="Permanent link">&para;</a></h3>
<p>The <code>UPDATE</code> store query updates selected attributes stored in a specific table, based on a given condition.</p>
<p><strong>Syntax</strong></p>
<pre class="codehilite"><code class="language-sql linenums">select &lt;attribute name&gt;, &lt;attribute name&gt;, ...?
update &lt;table&gt;
    set &lt;table&gt;.&lt;attribute name&gt; = (&lt;attribute name&gt;|&lt;expression&gt;)?, &lt;table&gt;.&lt;attribute name&gt; = (&lt;attribute name&gt;|&lt;expression&gt;)?, ...
    on &lt;condition&gt;</code></pre>

<p>The <code>condition</code> element specifies the basis on which records are selected to be updated.
When specifying the <code>condition</code>, table attributes must be referred to with the table name.</p>
<p>You can use the <code>set</code> keyword to update selected attributes from the table. Here, for each assignment, the attribute specified in the left must be the table attribute, and the one specified in the right can be a stream/table attribute a mathematical operation, or other. When the <code>set</code> clause is not provided, all the attributes in the table are updated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes must always be referred to with the table name as shown below: <br />
 <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>The following query updates the room occupancy by increasing the value of <code>people</code> by 1, in the <code>RoomOccupancyTable</code> 
table for each room number greater than 10.</p>
<pre class="codehilite"><code class="language-sql linenums">select 10 as roomNumber, 1 as arrival
update RoomTypeTable
    set RoomTypeTable.people = RoomTypeTable.people + arrival
    on RoomTypeTable.roomNo == roomNumber;</code></pre>

<pre class="codehilite"><code class="language-sql linenums">update RoomTypeTable
    set RoomTypeTable.people = RoomTypeTable.people + 1
    on RoomTypeTable.roomNo == 10;</code></pre>

<h3 id="update-or-insert_1">Update or Insert<a class="headerlink" href="#update-or-insert_1" title="Permanent link">&para;</a></h3>
<p>This allows you to update selected attributes if a record that meets the given conditions already exists in the specified  table. 
If a matching record does not exist, the entry is inserted as a new record.</p>
<p><strong>Syntax</strong></p>
<p><pre class="codehilite"><code class="language-sql linenums">select &lt;attribute name&gt;, &lt;attribute name&gt;, ...
update or insert into &lt;table&gt;
    set &lt;table&gt;.&lt;attribute name&gt; = &lt;expression&gt;, &lt;table&gt;.&lt;attribute name&gt; = &lt;expression&gt;, ...
    on &lt;condition&gt;</code></pre>
The <code>condition</code> element specifies the basis on which records are selected for update.
When specifying the <code>condition</code>, table attributes should be referred to with the table name.
If a record that matches the condition does not already exist in the table, the arriving event is inserted into the table.</p>
<p>The <code>set</code> clause is only used when an update is performed during the insert/update operation.
When <code>set</code> clause is used, the attribute to the left is always a table attribute, and the attribute to the right can be a stream/table attribute, mathematical
operation or other. The attribute to the left (i.e., the attribute in the event table) is updated with the value of the attribute to the right if the given condition is met. When the <code>set</code> clause is not provided, all the attributes in the table are updated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes must always be referred to with the table name as shown below: <br />
 <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>The following query tries to update the records in the <code>RoomAssigneeTable</code> table that have room numbers that match the
 same in the selection. If such records are not found, it inserts a new record based on the values provided in the selection. </p>
<pre class="codehilite"><code class="language-sql linenums">select 10 as roomNo, "single" as type, "abc" as assignee
update or insert into RoomAssigneeTable
    set RoomAssigneeTable.assignee = assignee
    on RoomAssigneeTable.roomNo == roomNo;</code></pre>

<h2 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h2>
<p>Siddhi supports an extension architecture to enhance its functionality by incorporating other libraries in a seamless manner. </p>
<p><strong>Purpose</strong></p>
<p>Extensions are supported because, Siddhi core cannot have all the functionality that's needed for all the use cases, mostly use cases require 
different type of functionality, and for some cases there can be gaps and you need to write the functionality by yourself.</p>
<p>All extensions have a namespace. This is used to identify the relevant extensions together, and to let you specifically call the extension.</p>
<p><strong>Syntax</strong></p>
<p>Extensions follow the following syntax;</p>
<pre class="codehilite"><code class="language-sql linenums">&lt;namespace&gt;:&lt;function name&gt;(&lt;parameter&gt;, &lt;parameter&gt;, ... )</code></pre>

<p>The following parameters are configured when referring a script function.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>namespace</code></td>
<td>Allows Siddhi to identify the extension without conflict</td>
</tr>
<tr>
<td><code>function name</code></td>
<td>The name of the function referred.</td>
</tr>
<tr>
<td><code>parameter</code></td>
<td>The function input parameter for function execution.</td>
</tr>
</tbody>
</table>
<p><a name="ExtensionTypes"></a>
<strong>Extension Types</strong></p>
<p>Siddhi supports following extension types:</p>
<ul>
<li>
<p><strong>Function</strong></p>
<p>For each event, it consumes zero or more parameters as input parameters and returns a single attribute. This can be used to manipulate existing event attributes to generate new attributes like any Function operation.</p>
<p>This is implemented by extending <code>io.siddhi.core.executor.function.FunctionExecutor</code>.</p>
<p>Example : </p>
<p><code>math:sin(x)</code> </p>
<p>Here, the <code>sin</code> function of <code>math</code> extension returns the sin value for the <code>x</code> parameter.</p>
</li>
<li>
<p><strong>Aggregate Function</strong></p>
<p>For each event, it consumes zero or more parameters as input parameters and returns a single attribute with aggregated results. This can be used in conjunction with a window in order to find the aggregated results based on the given window like any Aggregate Function operation. </p>
<p>This is implemented by extending <code>io.siddhi.core.query.selector.attribute.aggregator.AttributeAggregatorExecutor</code>.</p>
<p>Example : </p>
<p><code>custom:std(x)</code> </p>
<p>Here, the <code>std</code> aggregate function of <code>custom</code> extension returns the standard deviation of the <code>x</code> value based on its assigned window query. </p>
</li>
<li>
<p><strong>Window</strong> </p>
<p>This allows events to be <strong>collected, generated, dropped and expired anytime</strong> <strong>without altering</strong> the event format based on the given input parameters, similar to any other Window operator. </p>
<p>This is implemented by extending <code>io.siddhi.core.query.processor.stream.window.WindowProcessor</code>.</p>
<p>Example : </p>
<p><code>custom:unique(key)</code> </p>
<p>Here, the <code>unique</code> window of the <code>custom</code> extension retains one event for each unique <code>key</code> parameter.</p>
</li>
<li>
<p><strong>Stream Function</strong></p>
<p>This allows events to be  <strong>generated or dropped only during event arrival</strong> and <strong>altered</strong> by adding one or more attributes to it. </p>
<p>This is implemented by extending  <code>io.siddhi.core.query.processor.stream.function.StreamFunctionProcessor</code>.</p>
<p>Example :  </p>
<p><code>custom:pol2cart(theta,rho)</code> </p>
<p>Here, the <code>pol2cart</code> function of the <code>custom</code> extension returns all the events by calculating the cartesian coordinates <code>x</code> &amp; <code>y</code> and adding them as new attributes to the events.</p>
</li>
<li>
<p><strong>Stream Processor</strong></p>
<p>This allows events to be <strong>collected, generated, dropped and expired anytime</strong> by <strong>altering</strong> the event format by adding one or more attributes to it based on the given input parameters. </p>
<p>Implemented by extending <code>io.siddhi.core.query.processor.stream.StreamProcessor</code>.</p>
<p>Example :  </p>
<p><code>custom:perMinResults(&lt;parameter&gt;, &lt;parameter&gt;, ...)</code> </p>
<p>Here, the <code>perMinResults</code> function of the <code>custom</code> extension returns all events by adding one or more attributes to the events based on the conversion logic. Altered events are output every minute regardless of event arrivals.</p>
</li>
<li>
<p><strong>Sink</strong></p>
<p>Sinks provide a way to <strong>publish Siddhi events to external systems</strong> in the preferred data format. Sinks publish events from the streams via multiple transports to external endpoints in various data formats.</p>
<p>Implemented by extending <code>io.siddhi.core.stream.output.sink.Sink</code>.</p>
<p>Example : </p>
<p><code>@sink(type='sink_type', static_option_key1='static_option_value1')</code></p>
<p>To configure a stream to publish events via a sink, add the sink configuration to a stream definition by adding the @sink annotation with the required parameter values. The sink syntax is as above</p>
</li>
<li>
<p><strong>Source</strong></p>
<p>Source allows Siddhi to <strong>consume events from external systems</strong>, and map the events to adhere to the associated stream. Sources receive events via multiple transports and in various data formats, and direct them into streams for processing.</p>
<p>Implemented by extending <code>io.siddhi.core.stream.input.source.Source</code>.</p>
<p>Example : </p>
<p><code>@source(type='source_type', static.option.key1='static_option_value1')</code></p>
<p>To configure a stream that consumes events via a source, add the source configuration to a stream definition by adding the @source annotation with the required parameter values. The source syntax is as above</p>
</li>
<li>
<p><strong>Store</strong></p>
<p>You can use Store extension type to work with data/events <strong>stored in various data stores through the table abstraction</strong>. You can find more information about these extension types under the heading 'Extension types' in this document. </p>
<p>Implemented by extending <code>io.siddhi.core.table.record.AbstractRecordTable</code>.</p>
</li>
<li>
<p><strong>Script</strong></p>
<p>Scripts allow you to <strong>define a function</strong> operation that is not provided in Siddhi core or its extension. It is not required to write an extension to define the function logic. Scripts allow you to write functions in other programming languages and execute them within Siddhi queries. Functions defined via scripts can be accessed in queries similar to any other inbuilt function.</p>
<p>Implemented by extending <code>io.siddhi.core.function.Script</code>.</p>
</li>
<li>
<p><strong>Source Mapper</strong></p>
<p>Each <code>@source</code> configuration has a mapping denoted by the <code>@map</code> annotation that <strong>converts the incoming messages format to Siddhi events</strong>.The type parameter of the @map defines the map type to be used to map the data. The other parameters to be configured depends on the mapper selected. Some of these parameters are optional. </p>
<p>Implemented by extending <code>io.siddhi.core.stream.output.sink.SourceMapper</code>.</p>
<p>Example :</p>
<p><code>@map(type='map_type', static_option_key1='static_option_value1')</code></p>
</li>
<li>
<p><strong>Sink Mapper</strong></p>
<p>Each <code>@sink</code> configuration has a mapping denoted by the <code>@map</code> annotation that <strong>converts the outgoing Siddhi events to configured messages format</strong>.The type parameter of the @map defines the map type to be used to map the data. The other parameters to be configured depends on the mapper selected. Some of these parameters are optional. </p>
<p>Implemented by extending <code>io.siddhi.core.stream.output.sink.SinkMapper</code>.</p>
<p>Example :</p>
<p><code>@map(type='map_type', static_option_key1='static_option_value1')</code></p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>A window extension created with namespace <code>foo</code> and function name <code>unique</code> can be referred as follows:</p>
<pre class="codehilite"><code class="language-sql linenums">from StockExchangeStream[price &gt;= 20]#window.foo:unique(symbol)
select symbol, price
insert into StockQuote</code></pre>

<p><strong>Available Extensions</strong></p>
<p>Siddhi currently has several pre written extensions that are available <strong><a target="_blank" href="../extensions/">here</a></strong></p>
<p><em>We value your contribution on improving Siddhi and its extensions further.</em></p>
<h3 id="writing-custom-extensions">Writing Custom Extensions<a class="headerlink" href="#writing-custom-extensions" title="Permanent link">&para;</a></h3>
<p>Custom extensions can be written in order to cater use case specific logic that are not available in Siddhi out of the box or as an existing extension.</p>
<p>There are five types of Siddhi extensions that you can write to cater your specific use cases. These 
extension types and the related maven archetypes are given below. You can use these archetypes to generate Maven projects for each 
extension type.</p>
<ul>
<li>Follow the procedure for the required archetype, based on your project:</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the generated archetype please make sure you complete the @Extension
annotation with proper values. This annotation will be used to identify and document the extension, hence your
extension will not work without @Extension annotation.</p>
</div>
<p><strong>siddhi-execution</strong></p>
<p>Siddhi-execution provides following extension types:</p>
<ul>
<li>Function</li>
<li>Aggregate Function</li>
<li>Stream Function</li>
<li>Stream Processor</li>
<li>Window</li>
</ul>
<p>You can use one or more from above mentioned extension types and implement according to your requirement. </p>
<p>For more information about these extension types, see <a href="#ExtensionTypes">Extension Types</a>.</p>
<p>To install and implement the siddhi-io extension archetype, follow the procedure below:</p>
<ol>
<li>
<p>Issue the following command from your CLI.</p>
<pre class="codehilite"><code class="linenums">mvn archetype:generate
    -DarchetypeGroupId=org.wso2.siddhi.extension.archetype
    -DarchetypeArtifactId=siddhi-archetype-execution
    -DgroupId=org.wso2.extension.siddhi.execution
    -Dversion=1.0.0-SNAPSHOT</code></pre>


</li>
<li>
<p>Enter the mandatory properties prompted, please see the description for all properties below.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
<th>Mandatory</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>_nameOfFunction</td>
<td>Name of the custom function to be created</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>_nameSpaceOfFunction</td>
<td>Namespace of the function, used to grouped similar custom functions</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>groupIdPostfix</td>
<td>Namespace of the function is added as postfix to the groupId as a convention</td>
<td>N</td>
<td _nameSpaceOfFunction="_nameSpaceOfFunction"></td>
</tr>
<tr>
<td>artifactId</td>
<td>Artifact Id of the project</td>
<td>N</td>
<td _nameSpaceOfFunction="_nameSpaceOfFunction">siddhi-execution-</td>
</tr>
<tr>
<td>classNameOfAggregateFunction</td>
<td>Class name of the Aggregate Function</td>
<td>N</td>
<td _nameOfFunction="_nameOfFunction">$</td>
</tr>
<tr>
<td>classNameOfFunction</td>
<td>Class name of the Function</td>
<td>N</td>
<td _nameOfFunction="_nameOfFunction">$</td>
</tr>
<tr>
<td>classNameOfStreamFunction</td>
<td>Class name of the Stream Function</td>
<td>N</td>
<td _nameOfFunction="_nameOfFunction">$</td>
</tr>
<tr>
<td>classNameOfStreamProcessor</td>
<td>Class name of the Stream Processor</td>
<td>N</td>
<td _nameOfFunction="_nameOfFunction">$</td>
</tr>
<tr>
<td>classNameOfWindow</td>
<td>Class name of the Window</td>
<td>N</td>
<td _nameOfFunction="_nameOfFunction">$</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>To confirm that all property values are correct, type <code>Y</code> in the console. If not, press <code>N</code>.</p>
</li>
</ol>
<p><strong>siddhi-io</strong></p>
<p>Siddhi-io provides following extension types:</p>
<ul>
<li>Sink</li>
<li>Source</li>
</ul>
<p>You can use one or more from above mentioned extension types and implement according to your requirement. siddhi-io is generally used to work with IO operations as follows:
 * The Source extension type gets inputs to your Siddhi application.
 * The Sink extension publishes outputs from your Siddhi application. </p>
<p>For more information about these extension types, see <a href="#ExtensionTypes">Extension Types</a>.</p>
<p>To implement the siddhi-io extension archetype, follow the procedure below:</p>
<ol>
<li>
<p>Issue the following command from your CLI.</p>
<pre class="codehilite"><code class="linenums">mvn archetype:generate
    -DarchetypeGroupId=org.wso2.siddhi.extension.archetype
    -DarchetypeArtifactId=siddhi-archetype-io
    -DgroupId=org.wso2.extension.siddhi.io
    -Dversion=1.0.0-SNAPSHOT</code></pre>


</li>
<li>
<p>Enter the mandatory properties prompted, please see the description for all properties below.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
<th>Mandatory</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>_IOType</td>
<td>Type of IO for which Siddhi-io extension is written</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>groupIdPostfix</td>
<td>Type of the IO is added as postfix to the groupId as a convention</td>
<td>N</td>
<td _IOType="_IOType"></td>
</tr>
<tr>
<td>artifactId</td>
<td>Artifact Id of the project</td>
<td>N</td>
<td _IOType="_IOType">siddhi-io-</td>
</tr>
<tr>
<td>classNameOfSink</td>
<td>Class name of the Sink</td>
<td>N</td>
<td _IOType="_IOType"></td>
</tr>
<tr>
<td>classNameOfSource</td>
<td>Class name of the Source</td>
<td>N</td>
<td _IOType="_IOType"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>To confirm that all property values are correct, type <code>Y</code> in the console. If not, press <code>N</code>.</p>
</li>
</ol>
<p><strong>siddhi-map</strong></p>
<p>Siddhi-map provides following extension types,</p>
<ul>
<li>Sink Mapper</li>
<li>Source Mapper</li>
</ul>
<p>You can use one or more from above mentioned extension types and implement according to your requirement as follows.</p>
<ul>
<li>The Source Mapper maps events to a predefined data format (such as XML, JSON, binary, etc), and publishes them to external endpoints (such as E-mail, TCP, Kafka, HTTP, etc).</li>
<li>The Sink Mapper also maps events to a predefined data format, but it does it at the time of publishing events from a Siddhi application.</li>
</ul>
<p>For more information about these extension types, see <a href="#ExtensionTypes">Extension Types</a>.</p>
<p>To implement the siddhi-map extension archetype, follow the procedure below:</p>
<ol>
<li>
<p>Issue the following command from your CLI.                </p>
<pre class="codehilite"><code class="linenums">mvn archetype:generate
    -DarchetypeGroupId=org.wso2.siddhi.extension.archetype
    -DarchetypeArtifactId=siddhi-archetype-map
    -DgroupId=org.wso2.extension.siddhi.map
    -Dversion=1.0.0-SNAPSHOT</code></pre>


</li>
<li>
<p>Enter the mandatory properties prompted, please see the description for all properties below.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
<th>Mandatory</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>_mapType</td>
<td>Type of Mapper for which Siddhi-map extension is written</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>groupIdPostfix</td>
<td>Type of the Map is added as postfix to the groupId as a convention</td>
<td>N</td>
<td _mapType="_mapType"></td>
</tr>
<tr>
<td>artifactId</td>
<td>Artifact Id of the project</td>
<td>N</td>
<td _mapType="_mapType">siddhi-map-</td>
</tr>
<tr>
<td>classNameOfSinkMapper</td>
<td>Class name of the Sink Mapper</td>
<td>N</td>
<td _mapType="_mapType"></td>
</tr>
<tr>
<td>classNameOfSourceMapper</td>
<td>Class name of the Source Mapper</td>
<td>N</td>
<td _mapType="_mapType"></td>
</tr>
<tr>
<td>3. To confirm that all property values are correct, type <code>Y</code> in the console. If not, press <code>N</code>.</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</li>
</ol>
<p><strong>siddhi-script</strong></p>
<p>Siddhi-script provides the <code>Script</code> extension type.</p>
<p>The script extension type allows you to write functions in other programming languages and execute them within Siddhi queries. Functions defined via scripts can be accessed in queries similar to any other inbuilt function. </p>
<p>For more information about these extension types, see <a href="#ExtensionTypes">Extension Types</a>.</p>
<p>To implement the siddhi-script extension archetype, follow the procedure below:</p>
<ol>
<li>
<p>Issue the following command from your CLI.                   </p>
<p>mvn archetype:generate
       -DarchetypeGroupId=org.wso2.siddhi.extension.archetype
       -DarchetypeArtifactId=siddhi-archetype-script
       -DgroupId=org.wso2.extension.siddhi.script
       -Dversion=1.0.0-SNAPSHOT</p>
</li>
<li>
<p>Enter the mandatory properties prompted, please see the description for all properties below.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
<th>Mandatory</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>_nameOfScript</td>
<td>Name of Custom Script for which Siddhi-script extension is written</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>groupIdPostfix</td>
<td>Name of the Script is added as postfix to the groupId as a convention</td>
<td>N</td>
<td _nameOfScript="_nameOfScript"></td>
</tr>
<tr>
<td>artifactId</td>
<td>Artifact Id of the project</td>
<td>N</td>
<td _nameOfScript="_nameOfScript">siddhi-script-</td>
</tr>
<tr>
<td>classNameOfScript</td>
<td>Class name of the Script</td>
<td>N</td>
<td _nameOfScript="_nameOfScript">Eval</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>To confirm that all property values are correct, type <code>Y</code> in the console. If not, press <code>N</code>.</p>
</li>
</ol>
<p><strong>siddhi-store</strong></p>
<p>Siddhi-store provides the <code>Store</code> extension type.</p>
<p>The Store extension type allows you to work with data/events stored in various data stores through the table abstraction. </p>
<p>For more information about these extension types, see <a href="#ExtensionTypes">Extension Types</a>.</p>
<p>To implement the siddhi-store extension archetype, follow the procedure below:</p>
<ol>
<li>
<p>Issue the following command from your CLI.                      </p>
<p>mvn archetype:generate
      -DarchetypeGroupId=org.wso2.siddhi.extension.archetype
      -DarchetypeArtifactId=siddhi-archetype-store
      -DgroupId=org.wso2.extension.siddhi.store
      -Dversion=1.0.0-SNAPSHOT</p>
</li>
<li>
<p>Enter the mandatory properties prompted, please see the description for all properties below.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
<th>Mandatory</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>_storeType</td>
<td>Type of Store for which Siddhi-store extension is written</td>
<td>Y</td>
<td>-</td>
</tr>
<tr>
<td>groupIdPostfix</td>
<td>Type of the Store is added as postfix to the groupId as a convention</td>
<td>N</td>
<td _storeType="_storeType"></td>
</tr>
<tr>
<td>artifactId</td>
<td>Artifact Id of the project</td>
<td>N</td>
<td _storeType="_storeType">siddhi-store-</td>
</tr>
<tr>
<td>className</td>
<td>Class name of the Store</td>
<td>N</td>
<td _storeType="_storeType"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>To confirm that all property values are correct, type <code>Y</code> in the console. If not, press <code>N</code>.</p>
</li>
</ol>
<h2 id="configuring-and-monitoring-siddhi-applications">Configuring and Monitoring Siddhi Applications<a class="headerlink" href="#configuring-and-monitoring-siddhi-applications" title="Permanent link">&para;</a></h2>
<h3 id="threading-and-asynchronous">Threading and Asynchronous<a class="headerlink" href="#threading-and-asynchronous" title="Permanent link">&para;</a></h3>
<p>When <code>@Async</code> annotation is added to the Streams it enable the Streams to introduce asynchronous and multi-threading 
behaviour. </p>
<p><pre class="codehilite"><code class="language-sql linenums">@Async(buffer.size='256', workers='2', batch.size.max='5')
define stream &lt;stream name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... );</code></pre>
The following elements are configured with this annotation.</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>buffer.size</code></td>
<td>The size of the event buffer that will be used to handover the execution to other threads.</td>
<td>-</td>
</tr>
<tr>
<td><code>workers</code></td>
<td>Number of worker threads that will be be used to process the buffered events.</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>batch.size.max</code></td>
<td>The maximum number of events that will be processed together by a worker thread at a given time.</td>
<td><code>buffer.size</code></td>
</tr>
</tbody>
</table>
<h3 id="fault-streams">Fault Streams<a class="headerlink" href="#fault-streams" title="Permanent link">&para;</a></h3>
<p>When the <code>@OnError</code> annotation is added to a stream definition, it handles failover scenarios that occur during runtime gracefully.</p>
<pre class="codehilite"><code class="language-sql linenums">@OnError(action='on_error_action')
define stream &lt;stream name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... );</code></pre>

<p>The action parameter of the <code>@OnError</code> annotation defines the action to be executed during failure scenarios. </p>
<p>The following action types can be specified via the <code>@OnError</code> annotation when defining a stream. If this annotation is not added, <code>LOG</code> is the action type by default.</p>
<ul>
<li><code>LOG</code> : Logs the event with an error, and then drops the event.</li>
<li><code>STREAM</code>: A fault stream is automatically created for the base stream. The definition of the fault stream includes all the attributes of the base stream as well as an additional attribute named <code>_error</code>.
The events are inserted into the fault stream during a failure. The error identified is captured as the value for the <code>_error</code> attribute.</li>
</ul>
<p>e.g., the following is a Siddhi application that includes the <code>@OnError</code> annotation to handle failures during runtime.</p>
<pre class="codehilite"><code class="language-sql linenums">@OnError(name='STREAM')
define stream StreamA (symbol string, volume long);

from StreamA[custom:fault() &gt; volume] 
insert into StreamB;

from !StreamA#log("Error Occured")
select symbol, volume long, _error
insert into tempStream;</code></pre>

<p><code>!StreamA</code>, fault stream is automatically created when you add the <code>@OnError</code> annotation with the following attributes.
<pre class="codehilite"><code class="language-sql linenums">symbol string, volume long, _error object</code></pre></p>
<p>If you include the <code>on.error</code> parameter in the sink configuration, failures are handled by Siddhi at the time the events are published from the <code>Sink</code>.
<pre class="codehilite"><code class="language-sql linenums">@sink(type='sink_type', on.error='on.error.action')
define stream &lt;stream name&gt; (&lt;attribute name&gt; &lt;attribute type&gt;, &lt;attribute name&gt; &lt;attribute type&gt;, ... );</code></pre></p>
<p>The action types that can be specified via the <code>on.error</code> parameter when configuring a sink are as follows. If this parameter is not included in the sink configuration, <code>LOG</code> is the action type by default.</p>
<ul>
<li><code>LOG</code> : Logs the event with the error, and then drops the event.</li>
<li><code>WAIT</code> : The thread waits in the <code>back-off and re-trying</code> state, and reconnects once the connection is re-established.</li>
<li><code>STREAM</code>: Corresponding fault stream is populated with the failed event and the error while publishing. </li>
</ul>
<h3 id="statistics">Statistics<a class="headerlink" href="#statistics" title="Permanent link">&para;</a></h3>
<p>Use <code>@app:statistics</code> app level annotation to evaluate the performance of an application, you can enable the statistics of a Siddhi application to be published. This is done via the <code>@app:statistics</code> annotation that can be added to a Siddhi application as shown in the following example.</p>
<p><pre class="codehilite"><code class="language-sql linenums">@app:statistics(reporter = 'console')</code></pre>
The following elements are configured with this annotation.</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>reporter</code></td>
<td>The interface in which statistics for the Siddhi application are published. Possible values are as follows:<br/> <code>console</code><br/> <code>jmx</code></td>
<td><code>console</code></td>
</tr>
<tr>
<td><code>interval</code></td>
<td>The time interval (in seconds) at  which the statistics for the Siddhi application are reported.</td>
<td><code>60</code></td>
</tr>
<tr>
<td><code>include</code></td>
<td>If this parameter is added, only the types of metrics you specify are included in the reporting. The required metric types can be specified as a comma-separated list. It is also possible to use wild cards</td>
<td>All (<em>.</em>)</td>
</tr>
</tbody>
</table>
<p>The metrics are reported in the following format.
<code>io.siddhi.SiddhiApps.&lt;SiddhiAppName&gt;.Siddhi.&lt;Component Type&gt;.&lt;Component Name&gt;. &lt;Metrics name&gt;</code></p>
<p>The following table lists the types of metrics supported for different Siddhi application component types.</p>
<table>
<thead>
<tr>
<th>Component Type</th>
<th>Metrics Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stream</td>
<td>Throughput<br/>The size of the buffer if parallel processing is enabled via the @async annotation.</td>
</tr>
<tr>
<td>Trigger</td>
<td>Throughput (Trigger and Stream)</td>
</tr>
<tr>
<td>Source</td>
<td>Throughput</td>
</tr>
<tr>
<td>Sink</td>
<td>Throughput</td>
</tr>
<tr>
<td>Mapper</td>
<td>Latency<br/>Input/output throughput<br/></td>
</tr>
<tr>
<td>Table</td>
<td>Memory<br/>Throughput (For all operations)<br/>Throughput (For all operations)</td>
</tr>
<tr>
<td>Query</td>
<td>Memory<br/>Latency</td>
</tr>
<tr>
<td>Window</td>
<td>Throughput (For all operations)<br/>Latency (For all operation)</td>
</tr>
<tr>
<td>Partition</td>
<td>Throughput (For all operations)<br/>Latency (For all operation)</td>
</tr>
</tbody>
</table>
<p>e.g., the following is a Siddhi application that includes the <code>@app</code> annotation to report performance statistics.</p>
<pre class="codehilite"><code class="language-sql linenums">@App:name('TestMetrics')
@App:Statistics(reporter = 'console')

define stream TestStream (message string);

@info(name='logQuery')
from TestSream#log("Message:")
insert into TempSream;</code></pre>

<p>Statistics are reported for this Siddhi application as shown in the extract below.</p>
<details>
  <summary>Click to view the extract</summary>
11/26/17 8:01:20 PM ============================================================

 -- Gauges ----------------------------------------------------------------------
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Queries.logQuery.memory
              value = 5760
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Streams.TestStream.size
              value = 0

 -- Meters ----------------------------------------------------------------------
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Sources.TestStream.http.throughput
              count = 0
          mean rate = 0.00 events/second
      1-minute rate = 0.00 events/second
      5-minute rate = 0.00 events/second
     15-minute rate = 0.00 events/second
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Streams.TempSream.throughput
              count = 2
          mean rate = 0.04 events/second
      1-minute rate = 0.03 events/second
      5-minute rate = 0.01 events/second
     15-minute rate = 0.00 events/second
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Streams.TestStream.throughput
              count = 2
          mean rate = 0.04 events/second
      1-minute rate = 0.03 events/second
      5-minute rate = 0.01 events/second
     15-minute rate = 0.00 events/second

 -- Timers ----------------------------------------------------------------------
 io.siddhi.SiddhiApps.TestMetrics.Siddhi.Queries.logQuery.latency
              count = 2
          mean rate = 0.11 calls/second
      1-minute rate = 0.34 calls/second
      5-minute rate = 0.39 calls/second
     15-minute rate = 0.40 calls/second
                min = 0.61 milliseconds
                max = 1.08 milliseconds
               mean = 0.84 milliseconds
             stddev = 0.23 milliseconds
             median = 0.61 milliseconds
               75% <= 1.08 milliseconds
               95% <= 1.08 milliseconds
               98% <= 1.08 milliseconds
               99% <= 1.08 milliseconds
             99.9% <= 1.08 milliseconds


</details>

<h3 id="event-playback">Event Playback<a class="headerlink" href="#event-playback" title="Permanent link">&para;</a></h3>
<p>When <code>@app:playback</code> annotation is added to the app, the timestamp of the event (specified via an attribute) is treated as the current time. This results in events being processed faster.
The following elements are configured with this annotation.</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idle.time</code></td>
<td>If no events are received during a time interval specified (in milliseconds) via this element, the Siddhi system time is incremented by a number of seconds specified via the <code>increment</code> element.</td>
</tr>
<tr>
<td><code>increment</code></td>
<td>The number of seconds by which the Siddhi system time must be incremented if no events are received during the time interval specified via the <code>idle.time</code> element.</td>
</tr>
</tbody>
</table>
<p>e.g., In the following example, the Siddhi system time is incremented by two seconds if no events arrive for a time interval of 100 milliseconds.</p>
<p><code>@app:playback(idle.time = '100 millisecond', increment = '2 sec')</code></p>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../tooling/" title="Tooling" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tooling
              </span>
            </div>
          </a>
        
        
          <a href="../api/latest/" title="latest" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                latest
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.59145f40.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../assets/js/theme.js"></script>
      
        <script src="../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>